<!DOCTYPE html><html lang="pt-BR" dir="ltr"><head><meta charset="utf-8"><title>AngularJS: Criando filtros customizados e além – Rafaell Lycan</title><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"> <meta name="apple-mobile-web-app-capable" content="yes"><link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <meta name="description" content="Filtros são mal compreendidos no universo AngularJS, mas no geral eles são insanamente poderosos para transformar dados, e vão te ajudar muito no seu workflow de trabalho. "><meta name="keywords" content="desenvolvedor, front end, back end, developer, php, javascript, node, laravel, angular, react, software"><meta name="author" content="Rafaell Lycan - https://rafaell-lycan.com"/><meta name="reply-to" content="sonny.webdsg@gmail"/><link rel="canonical" href="https://rafaell-lycan.com/2017/angular-criando-filtros-customizados/"><link rel="alternate" type="application/rss+xml" href="https://feeds.feedburner.com/rafaell-lycan" title="Rafaell Lycan RSS Feed"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel='dns-prefetch' href='//s2.getsmartlook.com'><link rel='dns-prefetch' href='//rec.getsmartlook.com'><link rel="preconnect" href="//google-analytics.com" crossorigin /><link rel="preconnect" href="//www.google-analytics.com" crossorigin /><link rel="preconnect" href="//fonts.googleapis.com" crossorigin /><link rel='preconnect' href='//s2.getsmartlook.com' crossorigin><link rel='preconnect' href='//rec.getsmartlook.com' crossorigin> <meta name="google-site-verification" content="x08xUXYXTQWjHPyl9M_w5VIF07UWLSi0XUTxxCSS7rQ" /><meta name="robots" content="index, follow"><meta name="HandheldFriendly" content="True" /><meta name="MobileOptimized" content="320" /><meta name="mobile-web-app-capable" content="yes"><link rel="manifest" href="/manifest.json"><link rel="icon" sizes="192x192" href="/assets/img/icon-192x192.png"><link rel="icon" sizes="144x144" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon" sizes="128x128" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon-precomposed" sizes="128x128" href="/assets/img/icon-144x144.png"> <meta property="og:locale" content="pt_BR"><meta property="og:type" content=" article "><meta property="og:title" content="AngularJS: Criando filtros customizados e além – Rafaell Lycan"><meta property="og:url" content="https://rafaell-lycan.com/2017/angular-criando-filtros-customizados/"><meta property="og:image" content=""><meta property="og:description" content="Filtros são mal compreendidos no universo AngularJS, mas no geral eles são insanamente poderosos para transformar dados, e vão te ajudar muito no seu workflow de trabalho. "><meta property="og:site_name" content="Hi there, I'm Rafaell"><meta property="article:publisher" content="https://www.facebook.com/rafaell.lycan"> <meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://rafaell-lycan.com/2017/angular-criando-filtros-customizados/"><meta name="twitter:title" content="AngularJS: Criando filtros customizados e além – Rafaell Lycan"><meta name="twitter:image" content=""><meta name="twitter:description" content="Filtros são mal compreendidos no universo AngularJS, mas no geral eles são insanamente poderosos para transformar dados, e vão te ajudar muito no seu workflow de trabalho. "><meta name="twitter:creator" content="@RafaellLycan"><meta property="twitter:account_id" content="50549691"> <script type="text/javascript"> if (window.location.hostname !== 'localhost') { window.smartlook||(function(d) { var o=smartlook=function(){ o.api.push(arguments)},s=d.getElementsByTagName('script')[0]; var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript'; c.charset='utf-8';c.src='//rec.getsmartlook.com/bundle.js';s.parentNode.insertBefore(c,s); })(document); smartlook('init', '71b434ed5cffc14b8ccad3c50573871bcb972ef9'); } </script><link rel="stylesheet" href="/assets/css/style.css" media="all"></head><body><main class="wrap"><header class="header"><div class="container"><div class="author"> <a href="/"> <img src="/assets/img/rafaell-lycan.jpg" alt="Rafaell Lycan profile picture" title="Back to home" class="author__avatar"> </a></div><nav class="menu-list menu-list--inline"><ul class="default-list"><li class="menu-list__item"><a href="/about">About me</a></li><li class="menu-list__item"><a href="/">Blog</a></li> </ul></nav></div></header><article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting"><header class="blog-post__header"><h1 class="blog-post__title" itemprop="headline">AngularJS: Criando filtros customizados e além</h1><div class="blog-post__meta"> <span>This post is filed under</span> <a class="h6 post-tag" href="/tags#angular">angular</a> <span> • Published</span> <time class="h6" datetime="2017-04-21T00:00:00+02:00" itemprop="datePublished">21 Apr 2017</time> <span> • Reading time 10 min </span></div><p class="hidden" itemprop="keywords"></p></header><div class="blog-post__content"><p>Fala pessoal, tudo bem com vocês?</p><p>Eu estava lendo meus emails e esbarrei com 3 emails sobre dúvidas sobre algumas coisas no Angular, algumas perguntas mais avançadas onde até eu tive que dar uma olhada no StackOverflow para entender como solucionar e outras mais simples, onde creio que posso ajudar em um curto artigo.</p><h2 id="o-que-são-filtros-onde-vivem-e-o-que-comem">O que são Filtros, onde vivem e o que comem?</h2><p>Sei que muitos de vocês já sabem a respeito de filtros em um aplicação <a href="https://angularjs.org/">AngularJS</a>. Apesar deste tópico não ser avançado, acho que vale a leitura, mesmo que superficialmente.</p><p>Sabe quando você precisa formatar algum dado para exibí-lo ao usuário? O Angular já possui alguns filtros built-in como <code class="highlighter-rouge">currency</code>, <code class="highlighter-rouge">date</code> e outros. São muito úteis em uma aplicação. Vamos a uma breve descrição</p><blockquote><p>Transformam o resultado de uma expressão, realizando operações como formato de data, conversão de moeda e ordenação de arrays.</p><ul><li>Rodrigo Branas</li></ul></blockquote><h2 id="anatomia-de-filtros-em-angularjs">Anatomia de Filtros em AngularJS</h2><p>Segundo a <a href="https://docs.angularjs.org/guide/filter#creating-custom-filters">API para criação de filtros customizados</a>, não tem nada diferente do que já fazemos com um controller ou serviço, por exemplo.</p><p>Utilizamos <code class="highlighter-rouge">app.filter(filterName, function(){})</code>, o que é um padrão que utilizamos em todas as APIs até o momento.</p><p>Um filtro tem uma declaração bem próxima de um <code class="highlighter-rouge">.factory()</code> por exemplo mas com a vantagem de possuir um <strong>escopo global</strong> quando criado.</p><p>Vamos a um exemplo de código:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">angular</span>
  <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">,</span> <span class="p">[])</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'customFilter'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">newValue</span><span class="p">;</span>
      <span class="c1">// Funcionalidade do filtro</span>
      <span class="k">return</span> <span class="nx">newValue</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure><p>Vamos analisar alguns pontos:</p><ol><li>Fizemos un <code class="highlighter-rouge">get</code> no módulo <code class="highlighter-rouge">myAwesomeApp</code> e depois utilizamos o serviço <code class="highlighter-rouge">filter()</code> para declarar um novo filtro customizado.</li><li>O primeiro parâmetro é o nome do filtro, que no nosso caso é <code class="highlighter-rouge">'customFilter'</code>, e depois uma função que retorna uma função, que na verdade é o funcionamento do nosso filtro.</li><li>A função de retorno recebe por padrão o <code class="highlighter-rouge">input</code> que é o dado a ser filtrado e pode também receber parâmetros opcionais que retorna o output desejado seja ele uma string, um array com uma nova ordenação, um cálculo, etc.</li></ol><p>Para utilizarmos este filtro, seria preciso invoca-lo como ``.</p><p>Legal? Não, né? Até agora de fato não estamos vendo nada útil.</p><p>Antes de falarmos de coisas legais sobre filtros, vamos fazer um exemplo que realmente funcione:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">angular</span>
  <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">,</span> <span class="p">[])</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'reverse'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Retorna o valor reverso basedo em uma string</span>
      <span class="k">return</span> <span class="nx">input</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">''</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure><p>Agora podemos utilizar este filtro facilmente através de <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">'Rafaell'</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">reverse</span><span class="p">}</span><span class="err">}</span></code> e o output renderizado na expressão será <strong>lleafaR</strong>.</p><p>Vamos utilizar algumas boas práticas para deixar o mesmo código melhor, levando em conta que o módulo foi declarado em um outro arquivo e estamos criando nosso <code class="highlighter-rouge">reverse.filter.js</code>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// file reverse.filter.js</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">'use strict'</span><span class="p">;</span>
  
  <span class="nx">angular</span>
    <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">)</span> <span class="c1">// get module</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'reverse'</span><span class="p">,</span> <span class="nx">reverseFilter</span><span class="p">);</span>
  
  <span class="kd">function</span> <span class="nx">reverseFilter</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Retorna o valor reverso basedo em uma string</span>
      <span class="k">return</span> <span class="nx">input</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">''</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span></code></pre></figure><p>Apenas isolamos o código em uma closure, fizemos o <code class="highlighter-rouge">get</code> no módulo <code class="highlighter-rouge">myAwesomeApp</code> declarado em algum arquivo anterior e passamos a função <code class="highlighter-rouge">reverseFilter</code> como segundo parâmetro para nosso filtro.</p><p>Caso você esteja utilizando ES6 (Babel/TypeScript) o mesmo código poderia ser escrito da seguinte maneira:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// file reverse.filter.js</span>
<span class="kr">const</span> <span class="nx">reverseFilter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> 
  <span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">''</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  
  <span class="nx">angular</span>
    <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">)</span> <span class="c1">// get module</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'reverse'</span><span class="p">,</span> <span class="nx">reverseFilter</span><span class="p">);</span></code></pre></figure><p>Lembrando que é possível injetar o serviço <code class="highlighter-rouge">$filter</code> em um controller ou service, é interessante analisar que com um simples filtro podemos por exemplo validar se uma palavra é um <a href="https://en.wikipedia.org/wiki/Palindrome">palíndromo</a> ou não.</p><p>Quanto aos parâmetros opcionais, poderiamos criar um filtro <code class="highlighter-rouge">'ellipsis'</code> que adiciona um texto com mais de <strong>x</strong> caracteres onde podemos informar através de um parâmetro opcional o tamanho máximo do texto.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// file ellipsis.filter.js</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">'use strict'</span><span class="p">;</span>
  
  <span class="nx">angular</span>
    <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">)</span> <span class="c1">// get module</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'ellipsis'</span><span class="p">,</span> <span class="nx">ellipsisFilter</span><span class="p">);</span>
  
  <span class="kd">function</span> <span class="nx">ellipsisFilter</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">size</span> <span class="o">=</span> <span class="nx">size</span> <span class="o">||</span> <span class="mi">10</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="nx">size</span><span class="p">)</span> <span class="k">return</span> <span class="nx">input</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">input</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">)}</span> <span class="o">+</span> <span class="s1">'...'</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span></code></pre></figure><p>O mesmo código com ES6:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// file ellipsis.filter.js</span>
<span class="kr">const</span> <span class="nx">ellipsisFilter</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span>
  <span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="nx">size</span><span class="p">)</span> <span class="k">return</span> <span class="nx">input</span><span class="p">;</span>
    <span class="k">return</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">input</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">)}...</span><span class="err">`</span><span class="p">;</span>
  <span class="p">}</span>
  
<span class="nx">angular</span>
  <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">)</span> <span class="c1">// get module</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'ellipsis'</span><span class="p">,</span> <span class="nx">ellipsisFilter</span><span class="p">);</span></code></pre></figure><p>Este filtro pode ser utilizado com ou sem o parâmetro opcional, já que o informamos um valor default de <strong>10</strong> caso nada seja informado.</p><p>Filtro: <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">'Lorem</span><span class="w"> </span><span class="err">ipsum</span><span class="w"> </span><span class="err">dolor</span><span class="w"> </span><span class="err">sit</span><span class="w"> </span><span class="err">amet'</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">ellipsis</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> Output: <code class="highlighter-rouge">Lorem ipsu...</code></p><p>Filtro: <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">'Lorem</span><span class="w"> </span><span class="err">ipsum</span><span class="w"> </span><span class="err">dolor</span><span class="w"> </span><span class="err">sit</span><span class="w"> </span><span class="err">amet'</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">ellipsis</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="err">20</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> Output: <code class="highlighter-rouge">Lorem ipsum dolor si...</code></p><h2 id="filtros-aninhados">Filtros Aninhados</h2><p>Uma nota adicional sobre filtros é que você pode utilizá-los aninhados de maneira muito simples com nossos pipes (<code class="highlighter-rouge">|</code>), sempre lembrando que são utilizados da esquerda para direita.</p><p><code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">'Rafaell'</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">lowercase</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">reverse</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">ellipsis</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code></p><p>Nesse caso o texto é transformado em <strong>lowercase</strong>, depois o valor será revertido com <strong>reverse</strong> e por fim será aplicado <strong>ellipsis</strong>.</p><h2 id="filtros-stateful">Filtros Stateful</h2><p>Desde a versão 1.3 todos os filtros são <strong>stateless</strong> por padrão, assim se o <strong>input</strong> não foi modificado, então o resultado será o mesmo, isso faz que o <strong>$digest cycle</strong> não seja execute o filtro toda vez que algo mude no escopo da sua aplicação.</p><p>Na própria documentação é sugerido evitar a escrita de filtros <strong>stateful</strong> justamente por questões de performance que não podem ser otimizadas, e para fazer isso funcionar, o Angular assume que se a expressão informada para o filtro não seja modificada, o valor do filtro também permanecerá o mesmo. Isso é <strong>statelesss</strong>. Pensando que em alguns casos onde nossos filtros dependem de serviços para formatar o <strong>output</strong>.</p><p>Pensando em um cenário real, vamos dar uma olhada no filtro <code class="highlighter-rouge">translate</code> que pertence ao módulo <a href="https://angular-translate.github.io/">angular-translate</a>. Ele funciona através de <strong>chaves</strong> informados para procura-los em uma tabela de tradução carregada junto a aplicação, e caso nada seja encontrado, retorna a mesma chave utilizando o serviço <code class="highlighter-rouge">$translate</code>.</p><p><strong>Isso é stateful.</strong></p><p>Vejamos o uso deste filtro:</p><figure class="highlight"><pre><code class="language-html" data-lang="html">{{ 'TRANSLATION_KEY' | translate }}</code></pre></figure><p>Pensando neste contexto, Angular cria um cache sobre o valor da expressão e não modifica o valor do output a não seja que a chave <code class="highlighter-rouge">'TRANSLATION_KEY'</code> seja alterada.</p><p>E este é o problema, porque <code class="highlighter-rouge">'TRANSLATION_KEY'</code> nunca irá ser modificado. Imagine que o usuário modifica o idioma da página, utilizando a mesma <strong>chave</strong> que deveria checar na tebela de traduções, etc… porém, o valor gerado irá permanecer o mesmo justamente pelo fato dos filtros serem <strong>stateless</strong>.</p><p>Então como informamos ao Angular que as expressões passadas para nossos filtros devem ser recalculadas?</p><p>Tudo o que precisamos fazer é adicionar uma propriedade <code class="highlighter-rouge">$stateful</code> em nossa função antes de retorna-la.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">'use strict'</span><span class="p">;</span>
  
  <span class="nx">angular</span>
    <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">)</span> <span class="c1">// get module</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'customFilter'</span><span class="p">,</span> <span class="nx">customFilter</span><span class="p">);</span>
  
  <span class="c1">// Inject customService on the filter</span>
  <span class="nx">customFilter</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'customService'</span><span class="p">];</span>
  <span class="kd">function</span> <span class="nx">customFilter</span><span class="p">(</span><span class="nx">customService</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">filter</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Change input with some value from customService</span>
      <span class="k">return</span> <span class="nx">input</span> <span class="o">+=</span> <span class="nx">customService</span><span class="p">.</span><span class="nx">getData</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="nx">filter</span><span class="p">.</span><span class="nx">$stateful</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="nx">filter</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})();</span></code></pre></figure><p>Isso é tudo.</p><p>Claro que isso não acontece com o módulo <strong>angular-translate</strong>, já que ele possui uma flag <code class="highlighter-rouge">statefulFilter = true</code> que força o filtro a ser <strong>stateful</strong> por padrão.</p><h2 id="resposta-ao-leitor">Resposta ao leitor:</h2><p>Recebi um email do William Silveira com uma dúvida sobre como criar um filtro que calcula há quanto tempo uma mensagem foi enviada. Esse cálculo pode ser feito utilizando bibliotecas como <a href="https://momentjs.com/">moment.js</a>.</p><p>Um simples exemplo de como resolver este problema seria:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">'use strict'</span><span class="p">;</span>
  
  <span class="nx">angular</span>
    <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">)</span> <span class="c1">// get module</span>
    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'timeAgo'</span><span class="p">,</span> <span class="nx">timeAgo</span><span class="p">);</span>
  
  <span class="kd">function</span> <span class="nx">timeAgo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">input</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})();</span></code></pre></figure><p>A mesma implementação em ES6:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">moment</span> <span class="nx">from</span> <span class="s1">'moment'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">timeAgo</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> 
  <span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">input</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>
  
<span class="nx">angular</span>
  <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myAwesomeApp'</span><span class="p">)</span> <span class="c1">// get module</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">'timeAgo'</span><span class="p">,</span> <span class="nx">timeAgo</span><span class="p">);</span></code></pre></figure><p>E a utilização seria assim: <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">date</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="err">timeAgo</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code>.</p><h2 id="conclusão">Conclusão</h2><p>É importante sabermos que os filtros pode ser ferramentas poderosas para extender a apresentação de nossas aplicações e facilitar nosso trabalho. Tenha em mente que é uma recomendação evitar a criação de filtros <strong>stateful</strong>, justamente por conta de performance da sua aplicação. Uma melhor abordagem é sempre manter seus filtros <strong>stateless</strong> que recebem parâmetros.</p><p>Você pode ver todos os exemplos desenvolvidos no <a href="http://codepen.io/rafaell-lycan/full/GWVQOq/">CodePen</a>.</p><p>Sei que para quem já esta trabalhando com AngularJS a algum tempo, talvez este post não seja tão útil, mas espero poder ajudar pessoas com esse tipo de conteúdo.</p><p>Também gostaria de agradecer a <a href="https://twitter.com/marinalimeira_">@marinalimeira_</a> pela revisão :)</p><p>Até mais.</p></div><section class="share"><h3>Share this post</h3><ul class="social-list"><li class="social-list__item facebook hint--bottom" data-hint="Share on Facebook"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rafaell-lycan.com/2017/angular-criando-filtros-customizados/" target="share"> <span class="social-list__text">Like</span> </a></li><li class="social-list__item twitter hint--bottom" data-hint="Share on Twitter"> <a href="https://twitter.com/share?text=AngularJS: Criando filtros customizados e além&amp;url=https://rafaell-lycan.com/2017/angular-criando-filtros-customizados/" target="share"> <span class="social-list__text">Tweet</span> </a></li><li class="social-list__item gplus hint--bottom" data-hint="Share on Google Plus"> <a href="https://plus.google.com/share?url=https://rafaell-lycan.com/2017/angular-criando-filtros-customizados/" target="share"> <span class="social-list__text">+1</span> </a></li></ul></section><div class="comments"><div id="disqus_thread"></div></div><script> if (window.location.hostname !== 'localhost') { var disqus_shortname = 'rafaelllycan'; var disqus_identifier = '/2017/angular-criando-filtros-customizados'; var disqus_config = function () { this.page.url = 'https://rafaell-lycan.com/2017/angular-criando-filtros-customizados/'; this.page.identifier = '/2017/angular-criando-filtros-customizados'; }; (function() { var d = document, s = d.createElement('script'); s.src = '//' + disqus_shortname + '.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); s.async = true; (d.head || d.body).appendChild(s); })(); } </script></article><footer class="footer"><p> Made with <a href="https://jekyllrb.com/" target="_blank" class=" externalLink">Jekyll</a> and <span class="love">♥</span> by Rafaell Lycan.</p></footer></main><script async src="/assets/js/main.min.js"></script>  <script> !function(v,i,n,k,l,a){v.GoogleAnalyticsObject=n;v[n]||(v[n]=function(){ (v[n].q=v[n].q||[]).push(arguments)});v[n].l=+new Date;l=i.createElement(k); a=i.getElementsByTagName(k)[0];l.src='https://google-analytics.com/analytics.js'; a.parentNode.insertBefore(l,a)}(window,document,'ga','script'); ga('create', 'UA-16383035-5', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script></body></html>
