<!DOCTYPE html><html lang="pt-BR" dir="ltr"><head><meta charset="utf-8"><title>AngularJS: Consumindo Serviços RESTful – Rafaell Lycan</title><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"> <meta name="apple-mobile-web-app-capable" content="yes"><link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <meta name="description" content="Entender como o serviço $http funciona é algo bom e não envolve tantas surpresas no processo, porem, você pode se fascinar com o serviço $resource e o que ele pode proporcionar para a sua aplicação. "><meta name="keywords" content="desenvolvedor, front end, back end, developer, php, javascript, node, laravel, angular, react, software"><meta name="author" content="Rafaell Lycan - https://rafaell-lycan.com"/><meta name="reply-to" content="sonny.webdsg@gmail"/><link rel="canonical" href="https://rafaell-lycan.com/2015/angular-consumindo-servicos-restful/"><link rel="alternate" type="application/rss+xml" href="https://feeds.feedburner.com/rafaell-lycan" title="Rafaell Lycan RSS Feed"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel='dns-prefetch' href='//s2.getsmartlook.com'><link rel='dns-prefetch' href='//rec.getsmartlook.com'><link rel="preconnect" href="//google-analytics.com" crossorigin /><link rel="preconnect" href="//www.google-analytics.com" crossorigin /><link rel="preconnect" href="//fonts.googleapis.com" crossorigin /><link rel='preconnect' href='//s2.getsmartlook.com' crossorigin><link rel='preconnect' href='//rec.getsmartlook.com' crossorigin> <meta name="google-site-verification" content="x08xUXYXTQWjHPyl9M_w5VIF07UWLSi0XUTxxCSS7rQ" /><meta name="robots" content="index, follow"><meta name="HandheldFriendly" content="True" /><meta name="MobileOptimized" content="320" /><meta name="mobile-web-app-capable" content="yes"><link rel="manifest" href="/manifest.json"><link rel="icon" sizes="192x192" href="/assets/img/icon-192x192.png"><link rel="icon" sizes="144x144" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon" sizes="128x128" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon-precomposed" sizes="128x128" href="/assets/img/icon-144x144.png"> <meta property="og:locale" content="pt_BR"><meta property="og:type" content=" article "><meta property="og:title" content="AngularJS: Consumindo Serviços RESTful – Rafaell Lycan"><meta property="og:url" content="https://rafaell-lycan.com/2015/angular-consumindo-servicos-restful/"><meta property="og:image" content="https://rafaell-lycan.com/assets/img/posts/angularjs-restful.jpg"><meta property="og:description" content="Entender como o serviço $http funciona é algo bom e não envolve tantas surpresas no processo, porem, você pode se fascinar com o serviço $resource e o que ele pode proporcionar para a sua aplicação. "><meta property="og:site_name" content="Hi there, I'm Rafaell"><meta property="article:publisher" content="https://www.facebook.com/rafaell.lycan"> <meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://rafaell-lycan.com/2015/angular-consumindo-servicos-restful/"><meta name="twitter:title" content="AngularJS: Consumindo Serviços RESTful – Rafaell Lycan"><meta name="twitter:image" content="https://rafaell-lycan.com/assets/img/posts/angularjs-restful.jpg"><meta name="twitter:description" content="Entender como o serviço $http funciona é algo bom e não envolve tantas surpresas no processo, porem, você pode se fascinar com o serviço $resource e o que ele pode proporcionar para a sua aplicação. "><meta name="twitter:creator" content="@RafaellLycan"><meta property="twitter:account_id" content="50549691"> <script type="text/javascript"> if (window.location.hostname !== 'localhost') { window.smartlook||(function(d) { var o=smartlook=function(){ o.api.push(arguments)},s=d.getElementsByTagName('script')[0]; var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript'; c.charset='utf-8';c.src='//rec.getsmartlook.com/bundle.js';s.parentNode.insertBefore(c,s); })(document); smartlook('init', '71b434ed5cffc14b8ccad3c50573871bcb972ef9'); } </script><link rel="stylesheet" href="/assets/css/style.css" media="all"></head><body><main class="wrap"><header class="header"><div class="container"><div class="author"> <a href="/"> <img src="/assets/img/rafaell-lycan.jpg" alt="Rafaell Lycan profile picture" title="Back to home" class="author__avatar"> </a></div><nav class="menu-list menu-list--inline"><ul class="default-list"><li class="menu-list__item"><a href="/about">About me</a></li><li class="menu-list__item"><a href="/">Blog</a></li> </ul></nav></div></header><article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting"><header class="blog-post__header"><h1 class="blog-post__title" itemprop="headline">AngularJS: Consumindo Serviços RESTful</h1><div class="blog-post__meta"> <span>This post is filed under</span> <a class="h6 post-tag" href="/tags#angular">angular</a> <span> • Published</span> <time class="h6" datetime="2015-06-11T00:00:00+02:00" itemprop="datePublished">11 Jun 2015</time> <span> • Reading time 11 min </span></div><figure class="blog-post__banner"> <img src="/assets/img/posts/angularjs-restful.jpg" alt="AngularJS: Consumindo Serviços RESTful" title="AngularJS: Consumindo Serviços RESTful" itemprop="thumbnailUrl"></figure><p class="hidden" itemprop="keywords"></p></header><div class="blog-post__content"><p>A maioria das SPA’s utilizam operações <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a>, e você provavelmente deve utiliza-las. Vamos a um simples exemplo.</p><p>No <a href="https://angularjs.org/">Angular.js</a> temos dois serviços para enviar e recuperar dados de uma API através do verbo HTTP: o <a href="https://docs.angularjs.org/api/ng/service/$http">$http</a> e <a href="https://docs.angularjs.org/api/ngResource/service/$resource">$resource</a>.</p><p>Meh… ambos retornam uma <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Promise">promise</a> então porque eu deveria escolher um ao invés do outro?</p><h2 id="http-service">$http Service</h2><p>Vamos utilizar um simples código de exemplo:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MyController'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'$http'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s1">'/api/users'</span><span class="p">;</span>

  <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}]);</span></code></pre></figure><p>Se nosso objetivo é apenas retornar uma lista de dados, esta tudo pronto, inclusive tratando possíveis erros. Inclusive, é possível trabalhar exatamente como na <a href="http://api.jquery.com/jquery.ajax/">jQuery</a>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//....</span>
<span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">baseUrl</span><span class="p">).</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">list</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">//....</span></code></pre></figure><p>O Serviço <code class="highlighter-rouge">$http</code> sem dúvidas é importante em aplicações Angular, principalmente pelo simples fato de poder encadear promises e ser absurdamente simples de utilizar.</p><p>Agora vamos pensar de uma outra forma: Imagine que você vai criar um serviço interagindo diretamente com uma API <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a>, então esse nosso serviço tera métodos utilizando <code class="highlighter-rouge">$http.get</code>, <code class="highlighter-rouge">$http.post</code>, <code class="highlighter-rouge">$http.put</code> e <code class="highlighter-rouge">$http.delete</code> certo?</p><p>Logo somos obrigados a escrever novos métodos, e isso se resume em mais código que as vezes pode ser considerado desnecessário. Porque não utilizamos isso de uma forma otimizada?</p><h2 id="resource-service">$resource Service</h2><p>O Serviço <code class="highlighter-rouge">$resource</code> nada mais é do que uma fabrica que nos permite interagir com API’s RESTful facilmente e é construido sobre o serviço <code class="highlighter-rouge">$http</code>.</p><p>Talvez seja mais simples apenas mostrar um exemplo de código:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'MyService'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">'/api/users/:id'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MyController'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'MyService'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">MyService</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>
  <span class="nx">MyService</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}]);</span></code></pre></figure><p>Dificil não?</p><p>Um porem é que o <code class="highlighter-rouge">$resource</code> service diferente do <code class="highlighter-rouge">$http</code> service não vem junto com o pacote do Angular… Porque?</p><p>Se analisarmos o simples fato que em nossa aplicação não é necessário algo como o <code class="highlighter-rouge">$resource</code>, porque então carrega-lo?</p><p>Isso é algo interessante em SPA’s <del>varia do framework</del>, você não precisa utilizar tudo o que ela pode te proporcionar, apenas o que é interessante para a sua aplicação que talvez só precise de um simples <code class="highlighter-rouge">$http.get</code>.</p><p>Em todo caso, para utilizar-mos o <code class="highlighter-rouge">$resource</code> service precisamos adiciona-lo ao nosso projeto seja fazendo download do script ou adicionando o pacote <strong>angular-resource</strong> ao nosso projeto via <a href="http://bower.io/">Bower</a> ou <a href="https://www.npmjs.com/">NPM</a>.</p><p>Também precisamos injeta-lo no módulo principal da aplicação:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ngResource'</span><span class="p">]);</span></code></pre></figure><p>A API do <code class="highlighter-rouge">$resource</code> service nos retorna alguns métodos como <strong>get</strong>, <strong>save</strong>, <strong>query</strong>, <strong>remove</strong> e <strong>delete</strong>.</p><ul><li><strong>query():</strong> Uma solicitação GET para o recurso <code class="highlighter-rouge">/api/users/</code> ;</li><li><strong>get():</strong> Uma solicitação GET para o recurso <code class="highlighter-rouge">/api/users/:id</code>;</li><li><strong>save():</strong> Uma solicitação POST para o recurso <code class="highlighter-rouge">/api/users/</code> ;</li><li><strong>remove():</strong> Uma solicitação DELETE para o recurso <code class="highlighter-rouge">/api/users/:id</code>;</li><li><strong>delete():</strong> Uma solicitação DELETE para o recurso <code class="highlighter-rouge">/api/users/:id</code>;</li></ul><p>Você deve ter percebido que utilizamos <code class="highlighter-rouge">:id</code> como parâmetro opcional que será utilizados com alguns dos verbos acima como por exemplo:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">resource</span> <span class="o">=</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">'/api/users/:id'</span><span class="p">);</span>

<span class="c1">// GET /api/users/1</span>
<span class="nx">resource</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// DELETE /api/users/1</span>
<span class="nx">resource</span><span class="p">.</span><span class="k">delete</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="nx">id</span> <span class="p">});</span>

<span class="c1">// POST /api/users</span>
<span class="nx">resource</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span></code></pre></figure><p>Simples não é?</p><p>Os métodos <code class="highlighter-rouge">remove</code> e <code class="highlighter-rouge">delete</code> fazem exatamente a mesma ação, porem, como nem tudo é um mar de rosas, em certas versões do IE o delete pode não funcionar por ser uma palavra reservada. Por esse motivo o <code class="highlighter-rouge">remove</code> funciona como um <strong>alias</strong> para realizar a mesma ação.</p><p>Porem, ainda temos <strong>mais um goodie</strong>: Podemos utilizar alguns métodos que deixam nossas operações de CRUD ainda mais fáceis como <code class="highlighter-rouge">$save</code>, <code class="highlighter-rouge">$delete</code> e <code class="highlighter-rouge">$remove</code> que nos retornam uma <strong>promise</strong> propriamente dita, o que facilita muito em alguns casos como neste exemplo:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MyController'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="s1">'MyService'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">MyService</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">MyService</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"John Doe"</span><span class="p">;</span>
    <span class="c1">// Faz update e nos retorna uma promise (success/error)</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">$save</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}]);</span></code></pre></figure><p>Tudo muito bonito, tudo muito legal, mas vamos utilizar um exemplo que realmente faça sentido. Meu amigo <a href="https://twitter.com/wbrunom">@wbrunom</a> desenvolveu uma API RESTful em <a href="https://nodejs.org/">Node</a> como exemplo onde o tema principal são <strong>dragões</strong>, o link para a documentação pode ser visto <a href="https://dragons-api.herokuapp.com/">aqui</a>.</p><p>Vamos analisar nossos endpoints REST:</p><table class="table"><thead><tr><th>URL</th><th>Method</th><th>Params</th><th>Result</th></tr></thead><tbody><tr><td>/api/dragons</td><td>GET</td><td>NULL</td><td>All entries</td></tr><tr><td>/api/dragons/:slug</td><td>GET</td><td>NULL</td><td>Single entry</td></tr><tr><td>/api/dragons</td><td>POST</td><td>JSON String</td><td>Entry Created</td></tr><tr><td>/api/dragons/:slug</td><td>PUT</td><td>JSON String</td><td>Update Status</td></tr><tr><td>/api/dragons/:slug</td><td>DELETE</td><td>NULL</td><td>Delete Status</td></tr></tbody></table><p>Vamos desenvolver um serviço para consumir esta API de forma simples:</p><figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- index.html --&gt;</span>

<span class="nt">&lt;section</span> <span class="na">ng-controller=</span><span class="s">"mainController as vm"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>{{ vm.title }}<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">ng-repeat=</span><span class="s">"dragon in vm.dragons track by $index"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"dragon.name"</span><span class="nt">&gt;</span> <span class="nt">&lt;button</span> <span class="na">ng-click=</span><span class="s">"vm.updateDragon(dragon)"</span><span class="nt">&gt;</span>
        Update
      <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/section&gt;</span></code></pre></figure><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* app.js */</span>
<span class="p">;(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ngResource'</span><span class="p">]);</span>

  <span class="nx">angular</span><span class="p">.</span><span class="nx">bootstrap</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="p">[</span><span class="s1">'app'</span><span class="p">]);</span>
<span class="p">})(</span><span class="nx">angular</span><span class="p">);</span></code></pre></figure><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* dragonsApiResource.js */</span>
<span class="p">;(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">).</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'dragonsService'</span><span class="p">,</span> <span class="nx">dragonsService</span><span class="p">);</span>

  <span class="nx">dragonsService</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'$resource'</span><span class="p">];</span>

  <span class="kd">function</span> <span class="nx">dragonsService</span> <span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">'https://dragons-api.herokuapp.com/api/dragons/:slug'</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})(</span><span class="nx">angular</span><span class="p">);</span></code></pre></figure><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* mainController.js */</span>
<span class="p">;(</span><span class="kd">function</span><span class="p">(</span><span class="nx">angular</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'app'</span><span class="p">).</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'mainController'</span><span class="p">,</span> <span class="nx">mainController</span><span class="p">);</span>

  <span class="nx">mainController</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'dragonsService'</span><span class="p">];</span>

  <span class="kd">function</span> <span class="nx">mainController</span> <span class="p">(</span><span class="nx">dragonsService</span><span class="p">)</span> <span class="p">{</span>
  	<span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="nx">vm</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s2">"Dragons API"</span>

    <span class="nx">dragonsService</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">dragons</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">vm</span><span class="p">.</span><span class="nx">dragons</span> <span class="o">=</span> <span class="nx">dragons</span><span class="p">;</span>
    <span class="p">});</span>

  <span class="p">}</span>
<span class="p">})(</span><span class="nx">angular</span><span class="p">);</span></code></pre></figure><p>Apenas para informar, quando utilizamos o <code class="highlighter-rouge">angular.bootstrap</code> não fica mais necessário utilizar o ng-app em nossa aplicação. Assim conseguimos deixar nosso markup ainda mais limpo.</p><p>Sobre o HTML, utilizamos o <code class="highlighter-rouge">ng-repeat</code>, o que não é novidade para ninguem, mas também foi adicionado o <code class="highlighter-rouge">track by</code>, que é um parâmetro para otimizar o render dos elementos em loops como <code class="highlighter-rouge">ng-repeat</code> e <code class="highlighter-rouge">ng-options</code>.</p><p>O objetivo é atualizar os dados dragão, mas como no exemplo eu deixei apenas a informação do nome no input, referenciada no <code class="highlighter-rouge">ng-model</code>. No método <code class="highlighter-rouge">updateDragon</code>, disparado através do click do botão recebemos a informação do dragão relacionadas ao model, e como a entidade em si é um registro da nossa coleção <strong>dragons</strong> que veio do <code class="highlighter-rouge">$resource</code> service, ele nos fornece de graça o método <code class="highlighter-rouge">$save</code>, o que facilita o desenvolvimento de SPA. Certo?</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* mainController.js */</span>

  <span class="cm">/* .... */</span>

  <span class="nx">vm</span><span class="p">.</span><span class="nx">updateDragon</span> <span class="o">=</span> <span class="nx">updateDragon</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">updateDragon</span> <span class="p">(</span><span class="nx">dragon</span><span class="p">)</span> <span class="p">{</span>
  	<span class="nx">dragon</span><span class="p">.</span><span class="nx">$save</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="cm">/* .... */</span></code></pre></figure><p>Feito essas modificações em nosso controller, é a hora da verdade. Vamos atualizar um registro qualquer e ver o resultado.</p><figure class="highlight"><pre><code class="language-text" data-lang="text">POST https://dragons-api.herokuapp.com/api/dragons 500 (Internal Server Error)</code></pre></figure><p>Primeiramente precisamos entender que o <code class="highlighter-rouge">$resource</code> não possui um método que realize <code class="highlighter-rouge">PUT</code> nativamente. Na verdade, quando utilizamos os métodos <code class="highlighter-rouge">query()</code> e <code class="highlighter-rouge">get(:id)</code>, eles nos retornam uma coleção ou objeto do tipo <strong>Resource</strong>, o qual nativamente conta com alguns métodos especiais de entidade como <code class="highlighter-rouge">$save()</code>, <code class="highlighter-rouge">$delete()</code> e <code class="highlighter-rouge">$remove()</code>.</p><p>O método <code class="highlighter-rouge">$save()</code> realiza um <code class="highlighter-rouge">POST</code>, o que funciona caso o <strong>recurso</strong> não exista na API, porém quando update, o servidor precisa checar e realizar uma espécie de <strong>create or update</strong> como existe no <strong>activerecord</strong> <a href="http://rubyonrails.org/">Rails</a>.</p><p>Os método <code class="highlighter-rouge">$delete()</code> e <code class="highlighter-rouge">$remove()</code> realizam requisições do tipo <code class="highlighter-rouge">DELETE</code>. Entretando, isso só funciona desde que nós informamos a referência em nosso recurso.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* dragonsApiResource.js */</span>

  <span class="cm">/* .... */</span>

  <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">'https://dragons-api.herokuapp.com/api/dragons/:slug'</span><span class="p">,</span> <span class="p">{</span> <span class="na">slug</span><span class="p">:</span> <span class="s1">'@slug'</span> <span class="p">});</span>

  <span class="cm">/* .... */</span></code></pre></figure><p>O segundo parametro é um objeto que indica o que será mapeado no endpoint a cada vez que um método especial da entidade for executado. Nesse caso foi associado que nosso <code class="highlighter-rouge">:slug</code> estará relacionado a propriedade <code class="highlighter-rouge">@slug</code>.</p><p>Feito isso agora nosso método <code class="highlighter-rouge">$save</code> ira apontar para o slug caso nosso <strong>recurso</strong> possua o atributo <strong>slug</strong>, do contrário podemos criar uma nova entidade utilizando nosso <strong>dragonsService</strong>, o que ira lhe lembrar muito uma <code class="highlighter-rouge">Classe</code> ou <code class="highlighter-rouge">Model</code>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* dragonsApiResource.js */</span>

  <span class="cm">/* .... */</span>

  <span class="kd">var</span> <span class="nx">dragon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dragonsService</span><span class="p">();</span>
  <span class="nx">dragon</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"Meu Dragão"</span><span class="p">;</span>
  <span class="nx">dragon</span><span class="p">.</span><span class="nx">$save</span><span class="p">();</span>

  <span class="cm">/* .... */</span></code></pre></figure><p>Se funciona? Mas é claro que sim.</p><p>Foi criado um novo registro na API, o qual o slug é <code class="highlighter-rouge">meu-dragao</code>, e isso é ótimo caso seja utilizado da maneira correta, mas ainda não resolvemos o problema do update certo?</p><p>Como citei anteriormente, não possuimos um método o qual execute <code class="highlighter-rouge">PUT</code>, então a unica coisa que falta é o <strong>update</strong>. Para realizarmos essa operação, nós precisamos modificar nosso <strong>resource</strong> e deixa-lo mais customizável. Vejamos como:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* dragonsApiResource.js */</span>

  <span class="cm">/* .... */</span>

  <span class="kd">var</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">'https://dragons-api.herokuapp.com/api/dragons/:slug'</span><span class="p">,</span> <span class="p">{</span> <span class="na">slug</span><span class="p">:</span> <span class="s1">'@slug'</span> <span class="p">},</span> <span class="p">{</span>
    <span class="na">update</span> <span class="p">:</span> <span class="p">{</span>
      <span class="na">method</span><span class="p">:</span> <span class="s1">'PUT'</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="cm">/* .... */</span></code></pre></figure><p>O terceiro parametro é um objeto que nos permite adicionar quantos métodos especiais forem necessários para a aplicação utilizando o prefixo <code class="highlighter-rouge">$</code>.</p><p>Agora que temos disponível o método <code class="highlighter-rouge">$update</code>, vamos coloca-lo em uso:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* mainController.js */</span>

  <span class="cm">/* .... */</span>

  <span class="nx">vm</span><span class="p">.</span><span class="nx">updateDragon</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dragon</span><span class="p">)</span> <span class="p">{</span>
  	<span class="nx">dragon</span><span class="p">.</span><span class="nx">$update</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="cm">/* .... */</span></code></pre></figure><p>Note que o retorno da API não é o registro atualizado, nem nada do tipo. Então nesse caso para atualizarmos a view, seria interessante ter um método que realiza novamente um <code class="highlighter-rouge">GET</code> para atualizar nossa view.</p><p>Você pode ver a <a href="https://jsfiddle.net/xqo3onht/">minha versão</a> com esses métodos já implementados, porem o mais interessante seria criar métodos que iriam atuar dentro do próprio recurso para a realização do CRUD junto as validações necessárias e utiliza-las. Dessa forma criamos um padrão de assinatura de recurso em toda a aplicação aonde podemos utilizar promises através do <code class="highlighter-rouge">$q</code> e deixar nosso código mais legível e com o minimo possível de lógica nos controllers.</p><p>Existem ainda várias possibilidades para se utilizar o <code class="highlighter-rouge">$resource</code>, mas isso sera abordado com o tempo.</p><p>Espero que tenham entendido o conceito e as diferenças entre <code class="highlighter-rouge">$resource</code> e <code class="highlighter-rouge">$http</code>.</p></div><section class="share"><h3>Share this post</h3><ul class="social-list"><li class="social-list__item facebook hint--bottom" data-hint="Share on Facebook"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rafaell-lycan.com/2015/angular-consumindo-servicos-restful/" target="share"> <span class="social-list__text">Like</span> </a></li><li class="social-list__item twitter hint--bottom" data-hint="Share on Twitter"> <a href="https://twitter.com/share?text=AngularJS: Consumindo Serviços RESTful&amp;url=https://rafaell-lycan.com/2015/angular-consumindo-servicos-restful/" target="share"> <span class="social-list__text">Tweet</span> </a></li><li class="social-list__item gplus hint--bottom" data-hint="Share on Google Plus"> <a href="https://plus.google.com/share?url=https://rafaell-lycan.com/2015/angular-consumindo-servicos-restful/" target="share"> <span class="social-list__text">+1</span> </a></li></ul></section><section class="related"><h3 class="related__title">Referências</h3><ul class="default-list"><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://docs.angularjs.org/api/ngResource/service/$resource" title="$resource API" target="_blank"> <span itemprop="name">$resource API</span> </a></li><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="http://learn-angular.org/#!/lessons/ajax-with-resource" title="Ajax with $resource by Learn Angular.org" target="_blank"> <span itemprop="name">Ajax with $resource by Learn Angular.org</span> </a></li></ul></section><div class="comments"><div id="disqus_thread"></div></div><script> if (window.location.hostname !== 'localhost') { var disqus_shortname = 'rafaelllycan'; var disqus_identifier = '/2015/angular-consumindo-servicos-restful'; var disqus_config = function () { this.page.url = 'https://rafaell-lycan.com/2015/angular-consumindo-servicos-restful/'; this.page.identifier = '/2015/angular-consumindo-servicos-restful'; }; (function() { var d = document, s = d.createElement('script'); s.src = '//' + disqus_shortname + '.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); s.async = true; (d.head || d.body).appendChild(s); })(); } </script></article><footer class="footer"><p> Made with <a href="https://jekyllrb.com/" target="_blank" class=" externalLink">Jekyll</a> and <span class="love">♥</span> by Rafaell Lycan.</p></footer></main><script async src="/assets/js/main.min.js"></script>  <script> !function(v,i,n,k,l,a){v.GoogleAnalyticsObject=n;v[n]||(v[n]=function(){ (v[n].q=v[n].q||[]).push(arguments)});v[n].l=+new Date;l=i.createElement(k); a=i.getElementsByTagName(k)[0];l.src='https://google-analytics.com/analytics.js'; a.parentNode.insertBefore(l,a)}(window,document,'ga','script'); ga('create', 'UA-16383035-5', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script></body></html>
