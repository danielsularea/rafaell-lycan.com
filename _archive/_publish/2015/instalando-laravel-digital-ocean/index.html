<!DOCTYPE html><html lang="pt-BR" dir="ltr"><head><meta charset="utf-8"><title>Instalando Laravel 5 na DigitalOcean – Rafaell Lycan</title><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"> <meta name="apple-mobile-web-app-capable" content="yes"><link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <meta name="description" content="Saiba como instalar Laravel 5 na DigitalOcean utilizando Nginx em um server Ubuntu. "><meta name="keywords" content="laravel, instalar laravel, laravel cloud, digital ocean"><meta name="author" content="Rafaell Lycan - https://rafaell-lycan.com"/><meta name="reply-to" content="sonny.webdsg@gmail"/><link rel="canonical" href="https://rafaell-lycan.com/2015/instalando-laravel-digital-ocean/"><link rel="alternate" type="application/rss+xml" href="https://feeds.feedburner.com/rafaell-lycan" title="Rafaell Lycan RSS Feed"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel='dns-prefetch' href='//s2.getsmartlook.com'><link rel='dns-prefetch' href='//rec.getsmartlook.com'><link rel="preconnect" href="//google-analytics.com" crossorigin /><link rel="preconnect" href="//www.google-analytics.com" crossorigin /><link rel="preconnect" href="//fonts.googleapis.com" crossorigin /><link rel='preconnect' href='//s2.getsmartlook.com' crossorigin><link rel='preconnect' href='//rec.getsmartlook.com' crossorigin> <meta name="google-site-verification" content="x08xUXYXTQWjHPyl9M_w5VIF07UWLSi0XUTxxCSS7rQ" /><meta name="robots" content="index, follow"><meta name="HandheldFriendly" content="True" /><meta name="MobileOptimized" content="320" /><meta name="mobile-web-app-capable" content="yes"><link rel="manifest" href="/manifest.json"><link rel="icon" sizes="192x192" href="/assets/img/icon-192x192.png"><link rel="icon" sizes="144x144" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon" sizes="128x128" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon-precomposed" sizes="128x128" href="/assets/img/icon-144x144.png"> <meta property="og:locale" content="pt_BR"><meta property="og:type" content=" article "><meta property="og:title" content="Instalando Laravel 5 na DigitalOcean – Rafaell Lycan"><meta property="og:url" content="https://rafaell-lycan.com/2015/instalando-laravel-digital-ocean/"><meta property="og:image" content=""><meta property="og:description" content="Saiba como instalar Laravel 5 na DigitalOcean utilizando Nginx em um server Ubuntu. "><meta property="og:site_name" content="Hi there, I'm Rafaell"><meta property="article:publisher" content="https://www.facebook.com/rafaell.lycan"> <meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://rafaell-lycan.com/2015/instalando-laravel-digital-ocean/"><meta name="twitter:title" content="Instalando Laravel 5 na DigitalOcean – Rafaell Lycan"><meta name="twitter:image" content=""><meta name="twitter:description" content="Saiba como instalar Laravel 5 na DigitalOcean utilizando Nginx em um server Ubuntu. "><meta name="twitter:creator" content="@RafaellLycan"><meta property="twitter:account_id" content="50549691"> <script type="text/javascript"> if (window.location.hostname !== 'localhost') { window.smartlook||(function(d) { var o=smartlook=function(){ o.api.push(arguments)},s=d.getElementsByTagName('script')[0]; var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript'; c.charset='utf-8';c.src='//rec.getsmartlook.com/bundle.js';s.parentNode.insertBefore(c,s); })(document); smartlook('init', '71b434ed5cffc14b8ccad3c50573871bcb972ef9'); } </script><link rel="stylesheet" href="/assets/css/style.css" media="all"></head><body><main class="wrap"><header class="header"><div class="container"><div class="author"> <a href="/"> <img src="/assets/img/rafaell-lycan.jpg" alt="Rafaell Lycan profile picture" title="Back to home" class="author__avatar"> </a></div><nav class="menu-list menu-list--inline"><ul class="default-list"><li class="menu-list__item"><a href="/about">About me</a></li><li class="menu-list__item"><a href="/">Blog</a></li> </ul></nav></div></header><article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting"><header class="blog-post__header"><h1 class="blog-post__title" itemprop="headline">Instalando Laravel 5 na DigitalOcean</h1><div class="blog-post__meta"> <span>This post is filed under</span> <a class="h6 post-tag" href="/tags#laravel">laravel</a>, <a class="h6 post-tag" href="/tags#php">php</a> <span> • Published</span> <time class="h6" datetime="2015-12-19T00:00:00+01:00" itemprop="datePublished">19 Dec 2015</time> <span> • Reading time 7 min </span></div><p class="hidden" itemprop="keywords">laravel, instalar laravel, laravel cloud, digital ocean</p></header><div class="blog-post__content"><p>Fala pessoal, este post é mais para tirar dúvidas de algumas pessoas que tem me procurado com problemas na instalação do <a href="http://laravel.com/">Laravel</a> em Web Hosts que são bem limitados quanto a recursos e versão do PHP.</p><p>Alguns pontos sobre os pré-requisitos do Laravel (Até versão 5.1):</p><ul><li>PHP &gt;= 5.4</li><li>MCrypt PHP Extension</li></ul><p>Não irei passar por nenhuma parte de segurança, (Firewall, acesso, etc), apenas o básico de configuração:</p><ul><li><strong>Distribuição:</strong> Ubuntu 14.04;</li><li><strong>Web Server:</strong> Nginx;</li><li><strong>PHP Extensions:</strong> PHP-MYSQL, PHP-FPM, PHP-CLI, PHP-MCrypt;</li><li><strong>Databases:</strong> MySQL;</li><li><strong>Outros:</strong> Git;</li></ul><h2 id="setup">Setup</h2><p>A primeira coisa que precisamos fazer antes de instalar o Laravel, é configurar nosso ambiente, lembre-se que a instancia vem sem nada, precisamos configurar tudo do zero.</p><p>Precisamos atualizar os pacotes locais para atualizar a lista de pacotes disponíveis, só então adicionar os pacotes necessários:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo apt-get update
sudo apt-get install nginx mysql-server php5-mysql php5-fpm php5-cli php5-mcrypt git</code></pre></figure><p>Nesse post vamos utilizar o <a href="http://nginx.org/">Nginx</a> juntamente com os pacotes PHP necessários para conseguirmos rodar o Laravel sem problemas. Também precisamos instalar o <a href="https://git-scm.com/">Git</a>, já que ele é uma dependencia do <a href="https://getcomposer.org/">Composer</a> que irá gerenciar os pacotes do PHP quando instalarmos o Laravel.</p><p>Durante a instalação o MySQL irá fazer algumas perguntas relacionadas a <em>senha do root</em> (root password), mas caso você perca a chance de configurar uma senha nesta etapa, não se preocupe, é bem fácil faze-lo depois.</p><h4 id="configurando-o-mysql">Configurando o MySQL</h4><p>Bom, vou começar explicando pelo <a href="https://www.mysql.com/">MySQL</a> porque é o mais fácil de se configurar.</p><p>Depois de tudo instalado, vamos habilita-lo através do comando:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo mysql_install_db</code></pre></figure><p>Feito isso execute o comando abaixo para mantermos uma instalação mais “segura” informando a senha de root definida.</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo /usr/bin/mysql_secure_installation</code></pre></figure><p>Será apresentada uma tela como esta:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">Enter current password for root (enter for none):
OK, successfully used password, moving on...</code></pre></figure><p>Nessa hora você vai definir se quer mudar a senha de root novamente e outras várias opções onde você vai definir respondendo “n” para não e “y” para sim.</p><p><strong>DICA:</strong> Por padrão você pode apenas apertar “ENTER” para as demais perguntas, pois o MySQL já traz valores default nesta etapa de configuração, como remover alguns bancos de dados que não são utilizados, desabilitar logins remotos como root e carregar algumas regras quanto ao proprio sistema do MySQL.</p><p>Feito isso vamos a configuração do PHP.</p><h4 id="configurando-o-php">Configurando o PHP</h4><p>Com o PHP e as demais ferramentas instaladas, precisamos abilitar o PHP-FPM já que estamos utilizando o <strong>nginx</strong>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo vim /etc/php5/fpm/php.ini</code></pre></figure><p>Com o arquivo aberto, procure por <code class="highlighter-rouge">cgi.fix_pathinfo</code> e modifique o parametro para <code class="highlighter-rouge">0</code>, o qual por default é configurado com <code class="highlighter-rouge">1</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">cgi.fix_pathinfo=0</code></pre></figure><p>Isso impede que o PHP execute scripts com nomes similares quando não forem encontrados (sim, sério), e essa configuração é importante em questões de segurança, pois este comportamento permite que o servidor sofra tentativas de ataque e execute códigos que não deveria. Apenas salve o arquivo e podemos ser felizes.</p><p>Por ultimo precisamos habilitar é a extensão <em>MCrypt</em> que é uma dependencia do Laravel. Execute o comando <code class="highlighter-rouge">php5enmod</code> para habilita-lo facilmente de forma manual:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo php5enmod mcrypt</code></pre></figure><p>Agora só reiniciar o FPM e esta pronto a configuração do PHP:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo service php5-fpm restart</code></pre></figure><p>Feito isso vamos ao servidor.</p><h4 id="configurando-o-servidor-nginx">Configurando o Servidor Nginx</h4><p>Agora vem a parte legal da coisa, a configuração do nosso servidor de aplicação.</p><p>A primeira coisa que vamos fazer é definir o diretório <strong>root</strong> da aplicação. Nossa aplicação vai ficar localizada em <code class="highlighter-rouge">/var/www/laravel</code>. Coloquei Laravel apenas como convenção, mas você pode mudar para qualquer outro nome de sua preferência.</p><p>Normalmente apenas o folder <code class="highlighter-rouge">/var</code> esta criado por conta da estrutura <em>FHS</em> do sistema, mas nós vamos criar as outras pastas manualmente utilizando o parâmetro <code class="highlighter-rouge">-p</code> junto ao comando <code class="highlighter-rouge">mkdir</code>, que irá criar os folders necessários para construtir o path passado como argumento:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo mkdir -p /var/www/laravel</code></pre></figure><p>Feito isso, vamos adicionar a localização da nossa aplicação no bloco de configuração do Nginx:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo vim /etc/nginx/sites-available/default</code></pre></figure><p>Esse arquivo tem <strong>N</strong> coisas, mas relaxa, vamos basicamente modificar o bloco <code class="highlighter-rouge">server {}</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">server {
    listen 80 default_server;
    listen [::]:80 default_server ipv6only=on;

    root /var/www/laravel/public;
    index index.php index.html index.htm;

    server_name &lt;server domain / IP&gt;;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        try_files $uri /index.php =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}</code></pre></figure><p>Nessa etapa, modificamos o <em>document root</em> para <code class="highlighter-rouge">/var/www/laravel/public</code>, onde está o arquivo base da aplicação (index.php) que também foi adicionado na linha abaixo de arquivos de index.</p><p>Em <code class="highlighter-rouge">server_name</code> mudamos de <code class="highlighter-rouge">localhost</code> para o <strong>domínio</strong> ou <strong>IP</strong> do servidor. Caso você ainda não tem nenhum domínio configurado, apenas adicione o endereço IP do servidor.</p><p>Modificamos a entrada <code class="highlighter-rouge">try_files</code> que tentará por default servir um arquivo como padrão, mas caso o arquivo/rota não existir, o usuário sera redirecionado para o arquivo <code class="highlighter-rouge">index.php</code> da aplicação que pode ser seguido por uma <em>query string</em> como parâmetro opicional.</p><p>Foi criado um bloco específico para a execução de arquivos PHP, o qual ira tratar qualquer request a origens <code class="highlighter-rouge">*.php</code> e irá redirecionar como parâmetro para o nosso arquivo <code class="highlighter-rouge">index.php</code>.</p><p>Também foi habilitado o <code class="highlighter-rouge">fastcgi_*</code> que possui uma série de configurações para a execução correta através do socket feito com o PHP-FPM para se comunicar com o arquivo <code class="highlighter-rouge">index.php</code> usando diversas operações e tratamentos, e, utilizando o <code class="highlighter-rouge">SCRIPT_FILENAME</code> como parâmetro para que o PHP localize as requests corretamente e redirecione se necessário.</p><p>Salve o arquivo quando terminar estas edições e reinicie o servidor com o comando abaixo:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo service nginx restart</code></pre></figure><h2 id="instalando-o-laravel-via-composer">Instalando o Laravel via Composer</h2><p>Agora sim, com tudo configurado e rodando direito, vamos a instação. Primeiro volte para o diretório home do seu usuário. Vamos a instalação do <em>Composer</em>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">cd ~
curl -sS https://getcomposer.org/installer | php</code></pre></figure><p>Esse comando irá gerar o arquivo <code class="highlighter-rouge">composer.phar</code> em seu diretório home. Por mais que seja possível rodar a partir deste diretório, uma melhor estratégia é mante-lo disponível globalmente, dessa forma precisamos renomea-lo e move-lo para a pasta local:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo mv composer.phar /usr/local/bin/composer</code></pre></figure><p>No fim, apenas removemos a extensão do arquivo quando o mudamos de lugar, mas agora temos o comando composer instalado globalmente em nosso servidor.</p><p>Vamos instalar o Laravel, mas lembre-se que configuramos nosso servidor para servir a aplicação a partir do diretório <code class="highlighter-rouge">/var/www/laravel</code>:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo composer create-project laravel/laravel /var/www/laravel</code></pre></figure><p>Agora, com o Laravel instalado no path <code class="highlighter-rouge">/var/www/laravel</code> precisamos dar permissões para que o servidor possa executar os arquivos sem problemas:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo chown -R :www-data /var/www/laravel</code></pre></figure><p><strong>Nota:</strong> <code class="highlighter-rouge">www-data</code> é o grupo de usuários que o <em>Nginx</em> utiliza.</p><p>Vamos também alterar as permissões no diretório <code class="highlighter-rouge">/var/www/laravel/app/storage</code> apenas para escrita, para evitarmos problemas na execução da aplicação:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">sudo chmod -R 775 /var/www/laravel/app/storage</code></pre></figure><p>Por fim, como Laravel é um framework PHP, o que deixa claro que não precisamos compilar nada, acesse sua aplicação pelo domínio ou IP do servidor para verificar se tudo esta rodando corretamente:</p><figure class="highlight"><pre><code class="language-text" data-lang="text">http://&lt;server domain / IP&gt;</code></pre></figure><h2 id="conclusão">Conclusão</h2><p>Tudo o que foi mostrado aqui pode ser encontrado facilmente na internet visitando algumas páginas do Google e até mesmo os tutoriais no <a href="https://www.digitalocean.com/community/tutorials">site da Digital Ocean</a>.</p></div><section class="share"><h3>Share this post</h3><ul class="social-list"><li class="social-list__item facebook hint--bottom" data-hint="Share on Facebook"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rafaell-lycan.com/2015/instalando-laravel-digital-ocean/" target="share"> <span class="social-list__text">Like</span> </a></li><li class="social-list__item twitter hint--bottom" data-hint="Share on Twitter"> <a href="https://twitter.com/share?text=Instalando Laravel 5 na DigitalOcean&amp;url=https://rafaell-lycan.com/2015/instalando-laravel-digital-ocean/" target="share"> <span class="social-list__text">Tweet</span> </a></li><li class="social-list__item gplus hint--bottom" data-hint="Share on Google Plus"> <a href="https://plus.google.com/share?url=https://rafaell-lycan.com/2015/instalando-laravel-digital-ocean/" target="share"> <span class="social-list__text">+1</span> </a></li></ul></section><section class="related"><h3 class="related__title">Referências</h3><ul class="default-list"><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://www.digitalocean.com/community/tutorials/how-to-install-laravel-with-nginx-on-an-ubuntu-12-04-lts-vps" title="How To Install Laravel with Nginx on an Ubuntu 12.04 LTS VPS" target="_blank"> <span itemprop="name">How To Install Laravel with Nginx on an Ubuntu 12.04 LTS VPS</span> </a></li><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-on-ubuntu-12-04" title="How To Install Linux, nginx, MySQL, PHP (LEMP) stack on Ubuntu 12.04" target="_blank"> <span itemprop="name">How To Install Linux, nginx, MySQL, PHP (LEMP) stack on Ubuntu 12.04</span> </a></li></ul></section><div class="comments"><div id="disqus_thread"></div></div><script> if (window.location.hostname !== 'localhost') { var disqus_shortname = 'rafaelllycan'; var disqus_identifier = '/2015/instalando-laravel-digital-ocean'; var disqus_config = function () { this.page.url = 'https://rafaell-lycan.com/2015/instalando-laravel-digital-ocean/'; this.page.identifier = '/2015/instalando-laravel-digital-ocean'; }; (function() { var d = document, s = d.createElement('script'); s.src = '//' + disqus_shortname + '.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); s.async = true; (d.head || d.body).appendChild(s); })(); } </script></article><footer class="footer"><p> Made with <a href="https://jekyllrb.com/" target="_blank" class=" externalLink">Jekyll</a> and <span class="love">♥</span> by Rafaell Lycan.</p></footer></main><script async src="/assets/js/main.min.js"></script>  <script> !function(v,i,n,k,l,a){v.GoogleAnalyticsObject=n;v[n]||(v[n]=function(){ (v[n].q=v[n].q||[]).push(arguments)});v[n].l=+new Date;l=i.createElement(k); a=i.getElementsByTagName(k)[0];l.src='https://google-analytics.com/analytics.js'; a.parentNode.insertBefore(l,a)}(window,document,'ga','script'); ga('create', 'UA-16383035-5', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script></body></html>
