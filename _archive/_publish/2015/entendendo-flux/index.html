<!DOCTYPE html><html lang="pt-BR" dir="ltr"><head><meta charset="utf-8"><title>Entendendo Flux – Rafaell Lycan</title><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"> <meta name="apple-mobile-web-app-capable" content="yes"><link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon"> <meta name="description" content="Conheça o Flux, a arquitetura do Facebook para o desenvolvimento Front-End. "><meta name="keywords" content="desenvolvedor, front end, back end, developer, php, javascript, node, laravel, angular, react, software"><meta name="author" content="Rafaell Lycan - https://rafaell-lycan.com"/><meta name="reply-to" content="sonny.webdsg@gmail"/><link rel="canonical" href="https://rafaell-lycan.com/2015/entendendo-flux/"><link rel="alternate" type="application/rss+xml" href="https://feeds.feedburner.com/rafaell-lycan" title="Rafaell Lycan RSS Feed"><link rel="dns-prefetch" href="//google-analytics.com"><link rel="dns-prefetch" href="//www.google-analytics.com"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel='dns-prefetch' href='//s2.getsmartlook.com'><link rel='dns-prefetch' href='//rec.getsmartlook.com'><link rel="preconnect" href="//google-analytics.com" crossorigin /><link rel="preconnect" href="//www.google-analytics.com" crossorigin /><link rel="preconnect" href="//fonts.googleapis.com" crossorigin /><link rel='preconnect' href='//s2.getsmartlook.com' crossorigin><link rel='preconnect' href='//rec.getsmartlook.com' crossorigin> <meta name="google-site-verification" content="x08xUXYXTQWjHPyl9M_w5VIF07UWLSi0XUTxxCSS7rQ" /><meta name="robots" content="index, follow"><meta name="HandheldFriendly" content="True" /><meta name="MobileOptimized" content="320" /><meta name="mobile-web-app-capable" content="yes"><link rel="manifest" href="/manifest.json"><link rel="icon" sizes="192x192" href="/assets/img/icon-192x192.png"><link rel="icon" sizes="144x144" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon" sizes="128x128" href="/assets/img/icon-144x144.png"><link rel="apple-touch-icon-precomposed" sizes="128x128" href="/assets/img/icon-144x144.png"> <meta property="og:locale" content="pt_BR"><meta property="og:type" content=" article "><meta property="og:title" content="Entendendo Flux – Rafaell Lycan"><meta property="og:url" content="https://rafaell-lycan.com/2015/entendendo-flux/"><meta property="og:image" content="https://rafaell-lycan.com/assets/img/posts/entendendo-flux.jpg"><meta property="og:description" content="Conheça o Flux, a arquitetura do Facebook para o desenvolvimento Front-End. "><meta property="og:site_name" content="Hi there, I'm Rafaell"><meta property="article:publisher" content="https://www.facebook.com/rafaell.lycan"> <meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://rafaell-lycan.com/2015/entendendo-flux/"><meta name="twitter:title" content="Entendendo Flux – Rafaell Lycan"><meta name="twitter:image" content="https://rafaell-lycan.com/assets/img/posts/entendendo-flux.jpg"><meta name="twitter:description" content="Conheça o Flux, a arquitetura do Facebook para o desenvolvimento Front-End. "><meta name="twitter:creator" content="@RafaellLycan"><meta property="twitter:account_id" content="50549691"> <script type="text/javascript"> if (window.location.hostname !== 'localhost') { window.smartlook||(function(d) { var o=smartlook=function(){ o.api.push(arguments)},s=d.getElementsByTagName('script')[0]; var c=d.createElement('script');o.api=new Array();c.async=true;c.type='text/javascript'; c.charset='utf-8';c.src='//rec.getsmartlook.com/bundle.js';s.parentNode.insertBefore(c,s); })(document); smartlook('init', '71b434ed5cffc14b8ccad3c50573871bcb972ef9'); } </script><link rel="stylesheet" href="/assets/css/style.css" media="all"></head><body><main class="wrap"><header class="header"><div class="container"><div class="author"> <a href="/"> <img src="/assets/img/rafaell-lycan.jpg" alt="Rafaell Lycan profile picture" title="Back to home" class="author__avatar"> </a></div><nav class="menu-list menu-list--inline"><ul class="default-list"><li class="menu-list__item"><a href="/about">About me</a></li><li class="menu-list__item"><a href="/">Blog</a></li> </ul></nav></div></header><article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting"><header class="blog-post__header"><h1 class="blog-post__title" itemprop="headline">Entendendo Flux</h1><div class="blog-post__meta"> <span>This post is filed under</span> <a class="h6 post-tag" href="/tags#react">react</a>, <a class="h6 post-tag" href="/tags#javascript">javascript</a> <span> • Published</span> <time class="h6" datetime="2015-11-28T00:00:00+01:00" itemprop="datePublished">28 Nov 2015</time> <span> • Reading time 29 min </span></div><figure class="blog-post__banner"> <img src="/assets/img/posts/entendendo-flux.jpg" alt="Entendendo Flux" title="Entendendo Flux" itemprop="thumbnailUrl"></figure><p class="hidden" itemprop="keywords"></p></header><div class="blog-post__content"><p>No <a href="/2015/comecando-com-react/">post anterior</a>, dei uma breve introdução sobre <a href="https://facebook.github.io/react/">React.js</a>, mas chega a hora de deixar a brincadeira mais interessante ;)</p><p>Vamos falar sobre <a href="https://facebook.github.io/flux/">Flux</a>, um <strong>padrão de arquitetura</strong> criado/inventado pelo Facebook para lidar com um problema na construção de aplicações front-end baseadas em componentes. Sim, isso é meio confuso (e muito) a primeira vista, mas vamos a algumas explicações.</p><p>Você pode ler toda a parte técnica a seguir<del>(aka blablabla)</del>, ou ir direto para a <a href="#estruturando-nossa-aplicao">parte do código</a>.</p><h2 id="o-que-é">O que é?</h2><p>Atualmente está surgindo um novo paradigma no mundo de desenvolvimento de web apps. Esses aplicativos são <strong>quebrados</strong> em <strong>componentes reutilizáveis</strong> e <strong>combináveis/agregáveis</strong> e como consequência desse conceito é que os aplicativos seguem hierarquias baseadas em componentes. A grande vantagem de se utilizar componentes é que eles são desacoplados e isolados, o que não só facilita a manutenção, mas também pode impactar positivamente na sua produtividade ou a do seu time.</p><p>Para aqueles que estão acostumados com o <strong>data-binding</strong> convencional como eu, vão sem dúvidas ter <strong>“problemas”</strong> com o fluxo de dados nesse padrão de arquitetura.</p><p>Quando os desenvolvedores do Faceboook começaram a utilizar <strong>React</strong> dentro de sua plataforma, provavelmente sofreram com esses mesmos problemas e acabaram por definir esse <strong>novo padrão de arquitetura</strong> utilizando um método de <strong>transporte de dados unidirecional</strong>.</p><p>Porem, <strong>Flux</strong> esta mais para um novo <strong>conjunto de padrões</strong> do que um framework, e você pode utilizar em seus projetos sem ter que escrever/reescrever muito código.</p><h2 id="conceitos-arquitetônicos">Conceitos arquitetônicos</h2><p>Não vamos pensar em <strong>React</strong> por hora, porque agora que começa a parte legal, já que Flux é um pattern que não deve ser confundido com <em>MVC</em>, pois os conceitos que são necessários para entender o funcionamento das coisas é um paradigma diferente do que estamos acostumados:</p><h4 id="actions">Actions</h4><p>São os métodos para auxiliar o envio de informações ao <em>dispatcher</em>.</p><h4 id="dispatcher">Dispatcher</h4><p>É o <strong>ponto central da arquitetura</strong>, responsável por gerenciar/transmitir todo o fluxo de dados para todos os que devem receber aquela informação.</p><p>O Dispatcher é um <a href="https://en.wikipedia.org/wiki/Singleton_pattern">Singleton</a>, porem foi baseado no padrão <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">Publish Subscribe</a> e é um ponto de <strong>registro de callbacks</strong> para as <em>stores</em>. Cada <em>store</em> se registra e fornece um callback, e quando o <em>dispatcher</em> responder a uma ação, todas as <em>stores</em> registradas recebem os dados fornecidos pela ação.</p><p><strong>Utilizamos apenas um <em>dispatcher</em></strong> na aplicação justamente pelo fato dele ser o pilar da aplicação, logo <strong>sua aplicação deve ter apenas um único <em>dispatcher</em>.</strong></p><h4 id="stores">Stores</h4><p>É o lugar onde fica armazenada toda a lógica e o estado de sua aplicação e a implementação dos callbacks registrados para o <em>dispatcher</em>.</p><p><em>Stores</em> tem o papel pouco semelhante a um <em>model</em> no <strong>MVC</strong> tradicional, mas além disso elas gerenciam o <strong>estado</strong> de muitos objetos e não instâncias de um único objeto.</p><h4 id="views">Views</h4><p>São os componentes em React que trazem os estados das <em>stores</em> e passam para os componentes filhos através de suas <strong>“props”</strong>, onde temos um ou mais componentes <strong>root</strong> que escutam eventos de suas próprias <em>stores</em>. Podemos chamar isso de uma <strong>view-controller</strong> ainda que um pouco diferente de <em>controller</em> no modelo <em>MVC</em>, já que uma vez que obtem os dados das <em>stores</em>, atualiza seus componentes dependentes seguindo a estrutura <strong>top-down</strong>, podendo assim controlar qualquer parte significativa da página.</p><h2 id="flux--mvc">Flux !== MVC</h2><p>Como disse anteriormente, Flux não deve ser confundido com <em>MVC</em>, pois suas actions são acionadas diretamente de suas respectivas <em>stores</em> através do <em>dispatcher</em>. Mas para isso não ficar uma completa bagunça, imagine que <em>stores</em> são proximas a camada <em>model</em>, mas é muito complicado comparar a camada <em>view</em> pois ela é também o próprio controller de uma aplicação Flux.</p><h2 id="fluxo">Fluxo</h2><p>Já que ele não segue o modelo <em>MVC</em>, o flow também é diferente por ser unidirecional seguindo: <br /> <strong>Actions -&gt; Dispatcher -&gt; Stores -&gt; React Views.</strong></p><p><img src="http://i.stack.imgur.com/mpqFt.png" alt="Flux Flow" /></p><p>Sempre será esse o fluxo da sua aplicação, caso um componente React (View-Controller) realizar alguma ação, uma nova action será executada enviando informações ao <em>dispatcher</em> que irá atualizar as <em>stores</em> registradas que atualizará todas as views que precisarem ser afetadas.</p><h2 id="estruturando-nossa-aplicação">Estruturando nossa aplicação</h2><p>Nossa aplicação será um simples <strong>Shopping Cart</strong>, onde temos duas principais áreas, sendo a <strong>vitrine</strong> de produtos, e nosso <strong>carrinho</strong> em sí.</p><p>Você pode dar uma olhada neste <a href="https://facebook.github.io/flux/docs/todo-list.html">Tutorial</a> oficial do Facebook fazendo um Todo List.</p><p>Como eu acho que tenho bom gosto, nossa loja irá vender cervejas, porque apreciar cervejas é vida &lt;3</p><figure class="highlight"><pre><code class="language-html" data-lang="html">  <span class="c">&lt;!-- Basic flux structure --&gt;</span>
  - /js
  ---- /actions
  -------- CartActions.js
  ---- /components
  ---- /constants
  -------- CartConstants.js
  ---- /dispatcher
  -------- AppDispatcher.js
  ---- /stores
  -------- CartStore.js
  -------- ProductsStore.js
  ---- /utils
  -------- Products.js
  ---- app.js
  - index.html
  - package.json</code></pre></figure><p>Feito, vamos atualizar nosso <code class="highlighter-rouge">package.json</code> com os seguintes modulos:</p><ul><li>Browserify</li><li>Reactify</li><li>React</li><li>Flux</li></ul><figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"react-flux"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Simple Shopping Cart using React and Flux"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rafaell Lycan"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"js/app.js"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"flux"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.14.2"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"browserify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^12.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"reactify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"watchify"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.6.1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"watchify -o js/bundle.js -v -d ."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"browserify . -cm &gt; js/bundle.min.js"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"browserify"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"transform"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"reactify"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure><h2 id="html">HTML</h2><p>Sim, utilizei o <a href="http://getbootstrap.com/">Bootstrap</a> porque não estava com saco pra fazer algo do zero, e não estou nem ai se as classes dele não fazem o menor sentido.</p><p>Mas por favor, adicione também <a href="https://github.com/rafaell-lycan/estudos-react/blob/master/shopping-cart/css/style.css">este arquivo CSS</a>. Sua loja vai ficar mais <em>cool</em>. É sério, adiciona!</p><figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>React Flux - Shopping Cart<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"css/style.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;main</span> <span class="na">id=</span><span class="s">"main"</span><span class="nt">&gt;&lt;/main&gt;</span>

  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure><h2 id="mock">Mock</h2><p>Como não temos um servidor para solicitar os produtos com chamadas AJAX, vamos criar <a href="https://en.wikipedia.org/wiki/Mock_object">objeto mock</a> de retorno com alguns produtos.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// Load Mock Product Data Into localStorage</span>
  <span class="na">load</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="s1">'00001'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">123456</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'Brooklyn Lager'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="s1">'http://images.meredith.com/rrmag/images/2012/05/ss_BK-Lager.jpg'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">10.99</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">6</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="s1">'00002'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">123234</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'Abita Purple Haze'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="s1">'http://images.meredith.com/rrmag/images/2012/05/ss_Abita-Purple-Haze.jpg'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">7.99</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">2</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="s1">'00003'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">1236789</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'Miller High Life'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="s1">'http://images.meredith.com/rrmag/images/2012/05/ss_Miller.jpg'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">4.89</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">12</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">id</span> <span class="p">:</span> <span class="s1">'00004'</span><span class="p">,</span>
        <span class="na">sku</span><span class="p">:</span> <span class="mi">2346430</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'Samuel Adams Boston Lager'</span><span class="p">,</span>
        <span class="na">image</span><span class="p">:</span> <span class="s1">'http://images.meredith.com/rrmag/images/2012/05/ss_Sam-Adams.jpg'</span><span class="p">,</span>
        <span class="na">price</span><span class="p">:</span> <span class="mf">6.99</span><span class="p">,</span>
        <span class="na">inventory</span><span class="p">:</span> <span class="mi">4</span>
      <span class="p">},</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure><p>Ridiculo não?</p><p>Pense que em <strong>/utils</strong> você ira jogar toda e qualquer parte do seu sistema que não faça parte da estrutura flux.</p><p>Claro que você pode utilizar outros nomes, mas normalmente <strong>utils</strong> e <strong>helpers</strong> são mais genéricos <del>as vezes até de mais</del>.</p><h2 id="actions--constants">Actions &amp; Constants</h2><p>Actions são coleções de métodos que são chamadas pelas nossas <strong>“views”</strong> que enviam ações para o <em>dispatcher</em> contendo <strong>payloads</strong> que serão entregues as <em>stores</em>.</p><p>Um ponto interessante é que o Facebook as usa em conjunto com as <em>constantes</em> da aplicação, passando via payload o <code class="highlighter-rouge">actionType</code> usando assim as <em>constants</em>.</p><p>De uma olhada no arquivo <code class="highlighter-rouge">CartConstants.js</code>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">CART_ADD</span> <span class="p">:</span> <span class="s2">"CART_ADD"</span><span class="p">,</span>
  <span class="na">CART_REMOVE</span> <span class="p">:</span> <span class="s2">"CART_REMOVE"</span><span class="p">,</span>
  <span class="na">CART_VISIBLE</span> <span class="p">:</span> <span class="s2">"CART_VISIBLE"</span><span class="p">,</span>
  <span class="na">LOAD_PRODUCTS</span> <span class="p">:</span> <span class="s2">"LOAD_PRODUCTS"</span>
<span class="p">};</span></code></pre></figure><p>Uma outra abordagem para criar nossas <em>constants</em> é utilizando a lib <a href="https://www.npmjs.com/package/keymirror">keyMirror</a>, que simplesmente duplica o valor da chave para uma string, sem a necessidade de escrever novamente.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">keyMirror</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'keyMirror'</span><span class="p">);</span>
<span class="c1">// Versões anteriores do React contem o pacote em</span>
<span class="c1">// 'react/lib/keyMirror'</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">keyMirror</span><span class="p">({</span>
  <span class="na">CART_ADD</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">CART_REMOVE</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">CART_VISIBLE</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="na">LOAD_PRODUCTS</span> <span class="p">:</span> <span class="kc">null</span>
<span class="p">});</span></code></pre></figure><p>Eu não acho necessário, mas pode ser interessante para a sua aplicação.</p><p>Agora nosso arquivo <code class="highlighter-rouge">CartActions.js</code>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../dispatcher/AppDispatcher'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">CartConstants</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../constants/CartConstants'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">CartActionsActions</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// Load initial products</span>
  <span class="na">loadProducts</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">LOAD_PRODUCTS</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">data</span>
    <span class="p">})</span>
  <span class="p">},</span>

  <span class="c1">// Add item to cart</span>
  <span class="na">addToCart</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">productId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_ADD</span><span class="p">,</span>
      <span class="na">product</span><span class="p">:</span> <span class="nx">productId</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="c1">// Remove item from cart</span>
  <span class="nl">removeFromCart</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">productId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_REMOVE</span><span class="p">,</span>
      <span class="na">product</span><span class="p">:</span> <span class="nx">productId</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nl">toggleCaartVisible</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">isVisible</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span><span class="p">({</span>
      <span class="na">actionType</span><span class="p">:</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_VISIBLE</span><span class="p">,</span>
      <span class="na">isVisible</span><span class="p">:</span> <span class="nx">isVisible</span>
    <span class="p">})</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">CartActionsActions</span><span class="p">;</span></code></pre></figure><p>Perceba que nossas <em>actions</em> são bem simples. Nós <strong>carregamos os produtos</strong>, <strong>adicionamos</strong> e <strong>removemos</strong> produtos dos carrinho e manipulamos a <strong>visibilidade</strong> do carrinho.</p><p>Utilizamos o método <code class="highlighter-rouge">handleViewAction</code> que iremos implementar em nosso <em>dispatcher</em> que recebe um objeto como parametro onde por default adicionamos a propriedade <code class="highlighter-rouge">actionType</code> que utiliza nossas <em>constants</em> como recurso.</p><h2 id="o-dispatcher">O Dispatcher</h2><p>Falamos muito sobre o <em>Dispatcher</em>, mas vamos ver na prática como utilizar esse cara.</p><p>O Dispatcher é o cara que gerencia basicamente todo o processo da nossa aplicação, e a grande mágica que o faz ser o ponto central são os métodos <code class="highlighter-rouge">register</code> e <code class="highlighter-rouge">dispatch</code>, que são nossos <strong>triggers</strong> de eventos a entre a ação que disparou o evento e as <em>stores</em> registradas. Ele simplesmente recebe a <strong>action</strong> e propaga para as <em>stores</em> que ira identifica-la e disparar um evento caso registrado.</p><p><strong><em>Meh… então é um Pub/Sub mesmo?</em></strong></p><p>Mais ou menos isso, já que conceito do <em>dispatcher</em> é transmitir <strong>payloads</strong> para todas as <em>stores</em> registradas e seus respectivos callbacks.</p><p>Nosso arquivo <code class="highlighter-rouge">AppDispatcher.js</code> vai ficar assim:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Dispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'flux'</span><span class="p">).</span><span class="nx">Dispatcher</span><span class="p">,</span>
    <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dispatcher</span><span class="p">();</span>

<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">handleViewAction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">({</span>
    <span class="na">source</span> <span class="p">:</span> <span class="s1">'VIEW_ACTION'</span><span class="p">,</span>
    <span class="na">action</span> <span class="p">:</span> <span class="nx">action</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">AppDispatcher</span><span class="p">;</span></code></pre></figure><p>Note que criei uma instancia do Dispatcher e também o método <code class="highlighter-rouge">handleViewAction</code> com a simples finalidade de abstrair entre nossas actions das <strong>Views</strong> e nossas actions vindas de uma <strong>API/Servidor</strong>.</p><p>O método utiliza o método <code class="highlighter-rouge">dispatch</code> que faz toda a mágica de emitir o evento contendo em nossa propriedade <code class="highlighter-rouge">action</code> o payload com a ação/action e nosso dados.</p><h4 id="gotchas--tricks">Gotchas / Tricks</h4><p>Sua aplicação pode depender da execução/atualização de alguma outra <em>store</em> antes de renderizar novamente um componente, etc. Isso é possível utilizando o método <code class="highlighter-rouge">waitFor</code> que me foi muito útil quando passei por isso.</p><p><strong>Exemplo:</strong></p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/* ProductsStore.js */</span>
<span class="kd">let</span> <span class="nx">ProductsStore</span> <span class="o">=</span> <span class="p">...</span>
<span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">dispatcherIndex</span> <span class="o">=</span> <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{});</span>

<span class="cm">/* CartStore.js */</span>
<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">action</span><span class="p">.</span><span class="nx">actionType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">'PURSHASE_ITEMS'</span><span class="err">:</span>
      <span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">waitFor</span><span class="p">([</span>
        <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">dispatcherIndex</span>
      <span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">CartStore</span><span class="p">.</span><span class="nx">checkout</span><span class="p">(</span><span class="nx">_onCartProducts</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure><p>Quando o <em>dispatcher</em> transmitir a <em>action</em> <code class="highlighter-rouge">PURSHASE_ITEMS</code> no <code class="highlighter-rouge">CartStore</code>, antes de executar o método <code class="highlighter-rouge">checkout</code>, ele deve aguardar a execução dos eventos em <code class="highlighter-rouge">ProductsStore</code>.</p><h2 id="stores-1">Stores</h2><p>Falamos muito sobre <strong>stores</strong>, e agora que temos nossas actions definidas, chegou a hora de criar nossas <em>stores</em>.</p><p>Cada <em>Store</em> gerencia o estado de um dominio especifico da aplicação, nesse caso vamos criar nossa primeira <em>store</em> que sera responsável por gerenciar os produtos da loja, a <code class="highlighter-rouge">ProductStore.js</code>.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../dispatcher/AppDispatcher'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'events'</span><span class="p">).</span><span class="nx">EventEmitter</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">CartConstants</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../constants/CartConstants'</span><span class="p">);</span>

<span class="c1">// Initial data points</span>
<span class="kd">let</span> <span class="nx">_products</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// Will load products from some API</span>
<span class="kd">function</span> <span class="nx">loadProducts</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_products</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">ProductStoreFactory</span> <span class="kr">extends</span> <span class="nx">EventEmitter</span><span class="p">{</span>

  <span class="c1">// Return Product list</span>
  <span class="nx">getProducts</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_products</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Emit Change event</span>
  <span class="nx">emitChange</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'change'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Add change listener</span>
  <span class="nx">addChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Remove change listener</span>
  <span class="nx">removeChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="kd">let</span> <span class="nx">ProductStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductStoreFactory</span><span class="p">();</span>

<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>

  <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">actionType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">LOAD_PRODUCTS</span><span class="err">:</span>
      <span class="nx">loadProducts</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">ProductStore</span><span class="p">.</span><span class="nx">emitChange</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">ProductStore</span><span class="p">;</span></code></pre></figure><p>Utilizei a notação <code class="highlighter-rouge">class</code> do ES6 apenas para facilitar a criação da classe <code class="highlighter-rouge">ProductStoreFactory</code>, que por sua vez estende os métodos do <code class="highlighter-rouge">EventEmitter</code> onde adicionamos os métodos <code class="highlighter-rouge">emitChange</code>, <code class="highlighter-rouge">addChangeListener</code> e <code class="highlighter-rouge">removeChangeListener</code>.</p><p>Definimos os métodos o método privado <code class="highlighter-rouge">loadProducts</code> fora da nossa classe que adiciona a lista de produtos em nosso Array <code class="highlighter-rouge">_products</code>. Também deixamos o método <code class="highlighter-rouge">getProduct</code> exposto que nos retorna a lista de produtos.</p><p>Por fim, adicionamos um callback em nosso <code class="highlighter-rouge">AppDispatcher</code> através do método <strong>register</strong> que determina se o payload transmitido bate com alguma combinação em nosso bloco <code class="highlighter-rouge">switch</code> e então emitimos uma mudança em <code class="highlighter-rouge">ProductStore</code>.</p><p>O próximo passo é criar nosso <code class="highlighter-rouge">CartStore</code>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">AppDispatcher</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../dispatcher/AppDispatcher'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'events'</span><span class="p">).</span><span class="nx">EventEmitter</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">CartConstants</span> <span class="o">=</span>  <span class="nx">require</span><span class="p">(</span><span class="s1">'../constants/CartConstants'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">_products</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">_cartVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">ProductCartModel</span><span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">price</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sku</span> <span class="o">=</span> <span class="nx">product</span><span class="p">.</span><span class="nx">sku</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">_addItem</span> <span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProductCartModel</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">amount</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">_removeItem</span> <span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">delete</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">_setVisibility</span> <span class="p">(</span><span class="nx">visibility</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_cartVisible</span> <span class="o">=</span> <span class="nx">visibility</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">CartStoreFactory</span> <span class="kr">extends</span> <span class="nx">EventEmitter</span><span class="p">{</span>

  <span class="c1">// Return cart items</span>
  <span class="nx">getCartItems</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_products</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Return amount of items in cart</span>
  <span class="nx">getCartAmount</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">_products</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Return cart total cost</span>
  <span class="nx">getCartTotal</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">prod</span> <span class="k">in</span> <span class="nx">_products</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">total</span> <span class="o">+=</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">prod</span><span class="p">].</span><span class="nx">price</span> <span class="o">*</span> <span class="nx">_products</span><span class="p">[</span><span class="nx">prod</span><span class="p">].</span><span class="nx">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">total</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// Return cart visibility state</span>
  <span class="nx">getCartVisible</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_cartVisible</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Emit Change event</span>
  <span class="nx">emitChange</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">'change'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Add change listener</span>
  <span class="nx">addChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// Remove change listener</span>
  <span class="nx">removeChangeListener</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">CartStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CartStoreFactory</span><span class="p">();</span>

<span class="nx">AppDispatcher</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">action</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">actionType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_ADD</span><span class="err">:</span>
      <span class="nx">_addItem</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">product</span><span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_REMOVE</span><span class="err">:</span>
      <span class="nx">_removeItem</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">product</span><span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">CartConstants</span><span class="p">.</span><span class="nx">CART_VISIBLE</span><span class="err">:</span>
      <span class="nx">_setVisibility</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">CartStore</span><span class="p">.</span><span class="nx">emitChange</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">CartStore</span><span class="p">;</span></code></pre></figure><p>Basicamente o mesmo que a <em>store</em> anterior, temos nossa lista de produtos armazenada em <code class="highlighter-rouge">_products</code> que por sua vez é um objeto para facilitar a localização dos produtos através de sua <strong>‘key’</strong> e <code class="highlighter-rouge">_cartVisible</code> para definir o status do nosso cart.</p><p>Também adicionamos alguns métodos publicos que serão utilizados pelo <strong>View-Controller</strong> para definir o <em>state</em> da aplicação:</p><ul><li><code class="highlighter-rouge">getCartItems</code> : Retorna os itens em nosso carrinho;</li><li><code class="highlighter-rouge">getCartAmount</code> : Retorna o total de itens em nosso carrinho;</li><li><code class="highlighter-rouge">getCartTotal</code> : Retorna o valor total dos itens em nosso carrinho;</li><li><code class="highlighter-rouge">getCartVisible</code> : Retorna um boolean que irá omitir ou mostrar o carrinho em nosso layout.</li></ul><p>Você deve ter percebido que nessa <em>store</em> temos alguns métodos que são privados como <code class="highlighter-rouge">_addItem</code>, <code class="highlighter-rouge">_removeItem</code> e <code class="highlighter-rouge">_setVisibility</code> que serão utilizados a cada vez que um action vindo do <strong>payload</strong> bater com a condição em nosso <strong>register</strong>.</p><p>O legal é que em <code class="highlighter-rouge">_addItem</code>, ao invés de simplesmente jogar o produto dentro do carrinho, eu preferi fazer um mapper com a função ProductCartModel <del>poderia ter usando ES6, mas…</del> para me retornar um objeto apenas com o que realmente é necessário para o meu carrinho.</p><p>A cada vez que um produto é adicionado, nosso método verifica se o mesmo <strong>id</strong> encontra-se em nossa lista de produtos; Se sim, simplesmente <strong>incrementamos</strong> a quantidade; Do contrário criamos um novo produto mapeado e inserimos em nossa lista.</p><p>Agora que temos nossas <em>stores</em> criadas, vamos criar nossos Views e os respectivos componentes.</p><h2 id="view-controller">View Controller</h2><p>Apenas recaptulando que <strong>“view-controller”</strong> não tem nada haver com o padrão <em>MVC</em>, são apenas componentes que irão escutar por mudanças baseadas no <em>*estado</em> da aplicação vindas de nossas <em>stores</em>.</p><p>Vamos começar pelo simples, o <code class="highlighter-rouge">app.js</code>.</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">ShoppingCartApp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./components/Application'</span><span class="p">);</span>

<span class="nx">React</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">ShoppingCartApp</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'main'</span><span class="p">));</span></code></pre></figure><p>Agora que já temos um norte para seguir, nesse caso o componente <code class="highlighter-rouge">Application.js</code>, responsável por ser o <strong>root</strong> da nossa aplicação.</p><p>Vamos dar uma olhada:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ProductsStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../stores/ProductsStore'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">CartStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../stores/CartStore'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">ProductsComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./Products'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">CartComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./Cart'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">getApplicationState</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">products</span><span class="p">:</span> <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">getProducts</span><span class="p">(),</span>
    <span class="na">cart</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">items</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartItems</span><span class="p">(),</span>
      <span class="na">amount</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartAmount</span><span class="p">(),</span>
      <span class="na">total</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartTotal</span><span class="p">(),</span>
      <span class="na">isVisible</span><span class="p">:</span> <span class="nx">CartStore</span><span class="p">.</span><span class="nx">getCartVisible</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Create main View Controller</span>
<span class="kd">let</span> <span class="nx">Application</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Set initial state from Stores</span>
  <span class="na">getInitialState</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">getApplicationState</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="c1">// Add change listener to store</span>
  <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
    <span class="nx">CartStore</span><span class="p">.</span><span class="nx">addChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Remove change listener from store</span>
  <span class="na">componentWillUnmount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">ProductsStore</span><span class="p">.</span><span class="nx">removeChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
    <span class="nx">CartStore</span><span class="p">.</span><span class="nx">removeChangeListener</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_onChange</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Update state when store change</span>
  <span class="na">_onChange</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">getApplicationState</span><span class="p">());</span>
  <span class="p">},</span>

  <span class="na">renderCartComponent</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">CartComponent</span> <span class="nx">cart</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">cart</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span>  <span class="p">},</span>

  <span class="na">renderProductsComponent</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ProductsComponent</span> <span class="nx">products</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">products</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="err">;
</span>  <span class="p">},</span>

  <span class="c1">// Render the main component and childs, passing state via props</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"container"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"text-center"</span><span class="o">&gt;</span><span class="nx">Beer</span> <span class="nx">Shopping</span> <span class="nx">App</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderCartComponent</span><span class="p">()}</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderProductsComponent</span><span class="p">()}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">;</span></code></pre></figure><p>Sim, esse cara faz muitas coisas <del>coisa pra caralho…</del>, carrega nossas <em>stores</em>, adiciona os listeners nos eventos <code class="highlighter-rouge">componentDidMount</code> e <code class="highlighter-rouge">componentWillUnmount</code> no <strong>lifecycle</strong> do componente, renderiza os componentes <code class="highlighter-rouge">CartComponent</code> e <code class="highlighter-rouge">ProductsComponent</code> e ainda seta um estado/state inicial do componente que ira ser passado como referência para os demais componentes filhos através do método <code class="highlighter-rouge">getInitialState</code>.</p><p>Vejamos… cada componente, esta sendo renderizado através de uma função, isso eu descobri sendo uma boa prática ao invés de renderizar todos os <strong>N</strong> componentes direto no método <code class="highlighter-rouge">render</code> e depois simplesmente chamar executando o mesmo como por exemplo <code class="highlighter-rouge"><span class="p">{</span><span class="err">this.renderCartComponent()</span><span class="p">}</span></code>.</p><p>Agora vamos ao componente de produtos:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">CartActions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../actions/CartActions'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">ProductsMock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../utils/Products'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">Product</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./Product'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">Products</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Request products from somewhere</span>
  <span class="na">_loadProducts</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">CartActions</span><span class="p">.</span><span class="nx">loadProducts</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">ProductsMock</span><span class="p">.</span><span class="nx">load</span><span class="p">()));</span>
  <span class="p">},</span>

  <span class="c1">// Load products when the component render</span>
  <span class="na">componentDidMount</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_loadProducts</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="c1">// Parse our product list in Product component</span>
  <span class="na">renderProducts</span> <span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="p">(</span><span class="nx">product</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">Product</span>
          <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span>
          <span class="nx">product</span><span class="o">=</span><span class="p">{</span><span class="nx">product</span><span class="p">}</span>
          <span class="nx">addProduct</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">addProduct</span><span class="p">}</span>
        <span class="sr">/</span><span class="err">&gt;
</span>        <span class="p">)</span>
    <span class="p">});</span>
  <span class="p">},</span>

  <span class="c1">// Add Product action</span>
  <span class="na">addProduct</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">product</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">CartActions</span><span class="p">.</span><span class="nx">addToCart</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Render product view</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"row"</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderProducts</span><span class="p">()}</span>
      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Products</span><span class="p">;</span></code></pre></figure><p>O código acima esta bem auto-explicativo, mas vou dar alguns <strong>highlights</strong>:</p><p>Ao carregar o componente, o método <code class="highlighter-rouge">_loadProducts</code> é executado, o qual irá carregar os nossos produtos de algum lugar (nesse caso nosso Products<strong>Mock</strong>). Utilizei <code class="highlighter-rouge">setTimeout</code> apenas para garantir um processo assíncrono;</p><p>Renderizamos o componente <code class="highlighter-rouge">&lt;Product /&gt;</code> para cada produto que tivermos em nossa <em>store</em> utilizando <strong>Array.map()</strong> passando uma key para que cada componente seja único, o produto em sí e o método addProduct que irá fazer o <strong>trigger</strong> <code class="highlighter-rouge">addToCart</code> em nossas <strong>actions</strong> definidas anteriormente.</p><p>Antes de passarmos ao carrinho, vamos dar uma olhada em como ficou nosso <code class="highlighter-rouge">&lt;Product /&gt;</code>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">Product</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Render product view</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'col-md-3'</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h4</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'text-center'</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/h4</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">image</span><span class="p">}</span> <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'img-responsive img-thumbnail'</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;</span><span class="nx">b</span><span class="o">&gt;</span><span class="na">Price</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/b&gt; {this.props.product.price} &lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;</span><span class="nx">b</span><span class="o">&gt;</span><span class="na">Quantity</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/b&gt; {this.props.product.inventory} &lt;/</span><span class="nx">p</span><span class="o">&gt;</span>

        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s1">'btn btn-lg btn-block btn-danger'</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">addProduct</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">product</span><span class="p">)}</span><span class="o">&gt;</span><span class="nx">Add</span> <span class="nx">to</span> <span class="nx">Cart</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Product</span><span class="p">;</span></code></pre></figure><p>Esse sem dúvidas é o componente mais simples da aplicação, quase um componente <strong>burro</strong>, já que o único evento que ele tem é nosso <strong>click</strong>, que irá disparar o método <code class="highlighter-rouge">addProduct</code> passado como propriedade.</p><p>Enfim, vamos ao <code class="highlighter-rouge">&lt;CartComponent /&gt;</code>:</p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">CartActions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../actions/CartActions'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">Cart</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>

  <span class="c1">// Control display/hide of the cart</span>
  <span class="na">toggleCartDisplay</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="nx">CartActions</span><span class="p">.</span><span class="nx">toggleCaartVisible</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="c1">// Parse our cart produts in a list</span>
  <span class="na">removeProduct</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">productId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">CartActions</span><span class="p">.</span><span class="nx">removeFromCart</span><span class="p">(</span><span class="nx">productId</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="na">renderProductsList</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">products</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">product</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"beer-name"</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">name</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">amount</span><span class="p">}</span> <span class="nx">x</span> <span class="nx">$</span> <span class="p">{</span><span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">].</span><span class="nx">price</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"btn btn-danger btn-block"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">removeProduct</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">products</span><span class="p">[</span><span class="nx">product</span><span class="p">])}</span><span class="o">&gt;</span><span class="nx">Remove</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>      <span class="p">)</span>
    <span class="p">});</span>
  <span class="p">},</span>

  <span class="c1">// Render cart view</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"row cart-component"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"text-center"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"#"</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"btn btn-lg btn-danger"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">toggleCartDisplay</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Show</span> <span class="nx">Cart</span> <span class="p">({</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">amount</span><span class="p">})</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">isVisible</span><span class="p">?</span> <span class="s1">'cart-container'</span> <span class="p">:</span> <span class="s1">'cart-container hidden'</span><span class="p">}</span><span class="o">&gt;</span>

          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"#"</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"glyphicon glyphicon-remove close-btn"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">toggleCartDisplay</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>
          <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">renderProductsList</span><span class="p">()}</span>
          <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"total"</span><span class="o">&gt;</span><span class="na">Total</span><span class="p">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">total</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Cart</span><span class="p">;</span></code></pre></figure><p>Também bem auto-explicativo, com pequenas diferença devido a função exercida, mas nada de mais:</p><ul><li><strong>toggleCartDisplay</strong> é o responsável por mostrar/esconder o carrinho em sí;</li><li><strong>removeProduct</strong> faz o <strong>trigger</strong> <code class="highlighter-rouge">removeFromCart</code> em nossas <strong>actions</strong>;</li><li><strong>renderProductsList</strong> renderiza a lista de produtos dentro do carrinho, fazendo essa gambiarra que você esta vendo, já que estamos utilizando um <strong>objeto</strong> como lista.</li></ul><p>E é isso, só rodar e ser feliz. LoL</p><h2 id="conclusão">Conclusão</h2><p>Eu deveria ter escrito este post logo na sequência, mas tive alguns imprevistos e acabei deixando-o de lado por algumas semanas.</p><p>Entenda que <strong>React + Flux</strong> é sem sombra de dúvidas uma <strong>combinação poderosa</strong>, mas você deve ter em mente a necessidade de utiliza-la e como aplica-la em seu projeto, <strong>se não tudo pode vira uma completa salada</strong>, nada fica claro e alguem vai <strong>ter pesadelos</strong> sempre que for manter a aplicação.</p><p>Atualmente venho fazendo coisas legais com <em>React</em>, inclusive peguei alguns freelas para o exterior, onde dois projetos estavam utilizando essa mesma arquitetura com outros patterns como o <a href="https://github.com/reflux/refluxjs">Reflux</a>, que tem uma leve mudança quando ao <em>Flux</em>, mas nada muito complexo.</p><p>Você pode <a href="https://github.com/rafaell-lycan/estudos-react/tree/master/shopping-cart">baixar este exemplo aqui</a>.</p></div><section class="share"><h3>Share this post</h3><ul class="social-list"><li class="social-list__item facebook hint--bottom" data-hint="Share on Facebook"> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rafaell-lycan.com/2015/entendendo-flux/" target="share"> <span class="social-list__text">Like</span> </a></li><li class="social-list__item twitter hint--bottom" data-hint="Share on Twitter"> <a href="https://twitter.com/share?text=Entendendo Flux&amp;url=https://rafaell-lycan.com/2015/entendendo-flux/" target="share"> <span class="social-list__text">Tweet</span> </a></li><li class="social-list__item gplus hint--bottom" data-hint="Share on Google Plus"> <a href="https://plus.google.com/share?url=https://rafaell-lycan.com/2015/entendendo-flux/" target="share"> <span class="social-list__text">+1</span> </a></li></ul></section><section class="related"><h3 class="related__title">Referências</h3><ul class="default-list"><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://facebook.github.io/flux/docs/overview.html#content" title="Flux Docs - Overview" target="_blank"> <span itemprop="name">Flux Docs - Overview</span> </a></li><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="http://reactjsnews.com/getting-started-with-flux/" title="Getting Started with Flux" target="_blank"> <span itemprop="name">Getting Started with Flux</span> </a></li><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://facebook.github.io/flux/docs/todo-list.html" title="Flux TodoMVC Tutorial" target="_blank"> <span itemprop="name">Flux TodoMVC Tutorial</span> </a></li><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://www.youtube.com/watch?v=nYkdrAPrdcw" title="Rethinking Web App Development at Facebook (Youtube)" target="_blank"> <span itemprop="name">Rethinking Web App Development at Facebook (Youtube)</span> </a></li></ul></section><div class="comments"><div id="disqus_thread"></div></div><script> if (window.location.hostname !== 'localhost') { var disqus_shortname = 'rafaelllycan'; var disqus_identifier = '/2015/entendendo-flux'; var disqus_config = function () { this.page.url = 'https://rafaell-lycan.com/2015/entendendo-flux/'; this.page.identifier = '/2015/entendendo-flux'; }; (function() { var d = document, s = d.createElement('script'); s.src = '//' + disqus_shortname + '.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); s.async = true; (d.head || d.body).appendChild(s); })(); } </script></article><footer class="footer"><p> Made with <a href="https://jekyllrb.com/" target="_blank" class=" externalLink">Jekyll</a> and <span class="love">♥</span> by Rafaell Lycan.</p></footer></main><script async src="/assets/js/main.min.js"></script>  <script> !function(v,i,n,k,l,a){v.GoogleAnalyticsObject=n;v[n]||(v[n]=function(){ (v[n].q=v[n].q||[]).push(arguments)});v[n].l=+new Date;l=i.createElement(k); a=i.getElementsByTagName(k)[0];l.src='https://google-analytics.com/analytics.js'; a.parentNode.insertBefore(l,a)}(window,document,'ga','script'); ga('create', 'UA-16383035-5', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script></body></html>
